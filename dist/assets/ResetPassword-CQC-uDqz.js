import{i as s,j as e,a as N,z as E,d as A,al as b,V as y}from"./ui-vendor-BKTCjC1N.js";import{r as i,i as I,u as T}from"./react-vendor-a_rYd-gI.js";import{H as k,C,B as f}from"./index-CGNlKej4.js";import{I as P}from"./input-ChKtT3xH.js";import{L}from"./label-BQ8_nb15.js";import{I as z,J as B}from"./firebase-vendor-Dsl9zeYT.js";import"./chart-vendor-CfBne3GF.js";const F=()=>{const[o,n]=i.useState(!1),[d,c]=i.useState(null);return{loading:o,isValidToken:d,verifyResetCode:async a=>{try{return n(!0),await z(k,a),c(!0),!0}catch(t){return console.error("Erro ao verificar código de redefinição:",t),c(!1),t?.code==="auth/invalid-action-code"?s.error("Link de redefinição inválido ou expirado"):t?.code==="auth/expired-action-code"?s.error("Link de redefinição expirado"):s.error("Erro ao verificar link de redefinição"),!1}finally{n(!1)}},resetPassword:async(a,t)=>{try{return n(!0),await B(k,a,t),s.success("Senha redefinida com sucesso!"),!0}catch(r){return console.error("Erro ao redefinir senha:",r),r?.code==="auth/invalid-action-code"?s.error("Link de redefinição inválido ou expirado"):r?.code==="auth/expired-action-code"?s.error("Link de redefinição expirado"):r?.code==="auth/weak-password"?s.error("A senha é muito fraca. Tente uma senha mais forte"):r?.code==="auth/invalid-email"?s.error("E-mail inválido"):s.error("Erro ao redefinir senha. Tente novamente"),!1}finally{n(!1)}},validatePassword:a=>{if(a.length<6)return{isValid:!1,message:"A senha deve ter pelo menos 6 caracteres"};if(a.length>128)return{isValid:!1,message:"A senha deve ter no máximo 128 caracteres"};const t=/[a-zA-Z]/.test(a),r=/\d/.test(a);return t?r?{isValid:!0}:{isValid:!1,message:"A senha deve conter pelo menos um número"}:{isValid:!1,message:"A senha deve conter pelo menos uma letra"}},setIsValidToken:c}},K=()=>{const[o,n]=i.useState(""),[d,c]=i.useState(""),[h,p]=i.useState(!1),[x,a]=i.useState(!1),[t]=I(),r=T(),{loading:l,isValidToken:v,verifyResetCode:g,resetPassword:S,validatePassword:V,setIsValidToken:w}=F(),m=t.get("oobCode");i.useEffect(()=>{m?g(m):(w(!1),s.error("Link de redefinição inválido ou expirado"))},[m,g,w]);const R=async u=>{if(u.preventDefault(),!o.trim()||!d.trim()){s.error("Por favor, preencha todos os campos");return}if(o!==d){s.error("As senhas não coincidem");return}const j=V(o);if(!j.isValid){s.error(j.message);return}if(!m){s.error("Link de redefinição inválido");return}await S(m,o)&&r("/login")};return v===null?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-primary"}),e.jsx("p",{className:"text-muted-foreground",children:"Verificando link..."})]})}):v===!1?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx(C,{className:"w-full max-w-md p-6 shadow-card",children:e.jsxs("div",{className:"text-center",children:[e.jsx(E,{className:"h-16 w-16 text-destructive mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Link Inválido"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"O link de redefinição de senha é inválido ou expirou."}),e.jsx(f,{onClick:()=>r("/login"),className:"w-full",children:"Voltar ao Login"})]})})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs(C,{className:"w-full max-w-md p-6 shadow-card",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(A,{className:"h-16 w-16 text-success mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Redefinir Senha"}),e.jsx("p",{className:"text-muted-foreground",children:"Digite sua nova senha abaixo"})]}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"password",children:"Nova Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{id:"password",type:h?"text":"password",placeholder:"••••••••",value:o,onChange:u=>n(u.target.value),disabled:l,minLength:6,className:"pr-10"}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>p(!h),disabled:l,children:h?e.jsx(b,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(y,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mínimo de 6 caracteres, com pelo menos uma letra e um número"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"confirmPassword",children:"Confirmar Nova Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{id:"confirmPassword",type:x?"text":"password",placeholder:"••••••••",value:d,onChange:u=>c(u.target.value),disabled:l,minLength:6,className:"pr-10"}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>a(!x),disabled:l,children:x?e.jsx(b,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(y,{className:"h-4 w-4 text-muted-foreground"})})]})]}),e.jsx(f,{type:"submit",className:"w-full",disabled:l||!o.trim()||!d.trim(),children:l?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}),"Redefinindo..."]}):"Redefinir Senha"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(f,{variant:"ghost",onClick:()=>r("/login"),className:"text-sm text-muted-foreground hover:text-foreground",children:"Voltar ao Login"})})]})})};export{K as default};
