import{e as d,f as p,h as g,s as f,w as h}from"./firebase-vendor-BUxvNq0f.js";import{n as m}from"./index-LiAbW-2G.js";import{i as P}from"./ui-vendor-CYAqJ0RG.js";const i={email:!0,push:!0,paymentsPending:!0,goal50Percent:!0,goal75Percent:!0,goal100Percent:!0,goalReached:!0,newEmployees:!1,weeklyReports:!0,paymentOverdue:!0,lowBalance:!1,highActivity:!1},v=async o=>{try{if(!o)return console.error("âŒ userId nÃ£o fornecido"),i;console.log("ðŸ” Buscando preferÃªncias no Firestore para:",o);const e=d(m,"users",o,"preferences","notifications"),a=await p(e);if(a.exists()){const t=a.data();console.log("âœ… PreferÃªncias encontradas no Firestore:",t);const n={email:t.email??i.email,push:t.push??i.push,paymentsPending:t.paymentsPending??i.paymentsPending,goal50Percent:t.goal50Percent??i.goal50Percent,goal75Percent:t.goal75Percent??i.goal75Percent,goal100Percent:t.goal100Percent??i.goal100Percent,goalReached:t.goalReached??i.goalReached,newEmployees:t.newEmployees??i.newEmployees,weeklyReports:t.weeklyReports??i.weeklyReports,paymentOverdue:t.paymentOverdue??i.paymentOverdue,lowBalance:t.lowBalance??i.lowBalance,highActivity:t.highActivity??i.highActivity};return console.log("âœ… PreferÃªncias mescladas:",n),n}return console.log("ðŸ“ PreferÃªncias nÃ£o encontradas, retornando valores padrÃ£o"),i}catch(e){return console.error("âŒ Erro ao buscar preferÃªncias de notificaÃ§Ã£o:",e),console.error("Erro detalhado:",{code:e?.code,message:e?.message,stack:e?.stack}),i}},F=async(o,e)=>{try{const a=d(m,"users",o,"preferences","notifications");let t=i;try{const n=await p(a);if(n.exists()){const s=n.data();t={...i,...s}}}catch(n){console.warn("Erro ao buscar preferÃªncias atuais, usando padrÃµes:",n)}await g(a,{...t,...e,updatedAt:f()},{merge:!0}),console.log(`âœ… PreferÃªncias de notificaÃ§Ã£o atualizadas para usuÃ¡rio ${o}`)}catch(a){throw console.error("âŒ Erro ao salvar preferÃªncias de notificaÃ§Ã£o:",a),a}},$=async(o,e)=>{try{return(await v(o))[e]??i[e]}catch(a){return console.error("Erro ao verificar preferÃªncia de notificaÃ§Ã£o:",a),i[e]}},c=async(o,e,a=!0)=>{try{if(a){const r=w(e.type);if(r&&!await $(o,r)){console.log(`NotificaÃ§Ã£o ${e.type} desabilitada para usuÃ¡rio ${o}`);return}}const t=h(m,"users",o,"notifications"),n=d(t).id,s=Object.fromEntries(Object.entries(e).filter(([r,l])=>l!==void 0));await g(d(t,n),{...s,id:n,userId:o,read:!1,createdAt:f()}),console.log(`âœ… NotificaÃ§Ã£o enviada para usuÃ¡rio ${o}:`,e.title),P.info(e.title,{description:e.message,duration:5e3})}catch(t){throw console.error("âŒ Erro ao enviar notificaÃ§Ã£o:",t),t}},w=o=>({goal_50:"goal50Percent",goal_75:"goal75Percent",goal_100:"goal100Percent",goal_reached:"goalReached",payment_pending:"paymentsPending",payment_overdue:"paymentOverdue",new_employee:"newEmployees",low_balance:"lowBalance",high_activity:"highActivity"})[o]||null,R=async(o,e,a,t,n,s)=>{const r={free:"Free",standard:"Standard",medium:"Medium",ultimate:"Ultimate"},l=r[a]||a,y=r[t]||t,u={type:"plan_change",title:"Plano Alterado",message:`Seu plano foi alterado de ${l} para ${y}${s?`. Motivo: ${s}`:""}.`,metadata:{oldPlan:a,newPlan:t,changedBy:n,...s&&{reason:s}}};await c(o,u)},_=async(o,e,a)=>{const t={type:"admin_promotion",title:"PrivilÃ©gios de Admin Concedidos",message:`VocÃª foi promovido a administrador${a?`. Motivo: ${a}`:""}.`,metadata:{changedBy:e,...a&&{reason:a}}};await c(o,t)},E=async(o,e,a)=>{const t={type:"admin_demotion",title:"PrivilÃ©gios de Admin Removidos",message:`Seus privilÃ©gios de administrador foram removidos${`. Motivo: ${a}`}.`,metadata:{changedBy:e,reason:a}};await c(o,t)},A=async(o,e,a,t)=>{let n,s,r;if(e>=100)n="goal_100",s="ðŸŽ¯ Meta Mensal Atingida!",r=`ParabÃ©ns! VocÃª atingiu 100% da sua meta mensal de R$ ${t.toLocaleString("pt-BR")}. Valor atual: R$ ${a.toLocaleString("pt-BR")}`;else if(e>=75)n="goal_75",s="ðŸš€ 75% da Meta Atingida!",r=`Ã“timo progresso! VocÃª jÃ¡ atingiu 75% da sua meta mensal. Restam apenas 25% para alcanÃ§ar R$ ${t.toLocaleString("pt-BR")}. Valor atual: R$ ${a.toLocaleString("pt-BR")}`;else if(e>=50)n="goal_50",s="ðŸ“ˆ 50% da Meta Atingida!",r=`ParabÃ©ns! VocÃª jÃ¡ atingiu metade da sua meta mensal. Continue assim! Valor atual: R$ ${a.toLocaleString("pt-BR")} de R$ ${t.toLocaleString("pt-BR")}`;else return;await c(o,{type:n,title:s,message:r,metadata:{goalValue:t,currentValue:a,percentage:e}})},N=async(o,e,a)=>{await c(o,{type:"goal_reached",title:"ðŸŽ‰ Meta Mensal Superada!",message:`IncrÃ­vel! VocÃª nÃ£o apenas atingiu, mas superou sua meta mensal! Valor atual: R$ ${e.toLocaleString("pt-BR")} (meta: R$ ${a.toLocaleString("pt-BR")})`,metadata:{goalValue:a,currentValue:e,percentage:100}})},B=async(o,e,a,t)=>{await c(o,{type:"payment_pending",title:"ðŸ’° Pagamento Pendente",message:`O pagamento de ${e} no valor de R$ ${a.toLocaleString("pt-BR")} estÃ¡ pendente.`,metadata:{paymentId:t,amount:a,employeeName:e}})},b=async(o,e,a,t,n)=>{await c(o,{type:"payment_overdue",title:"âš ï¸ Pagamento Atrasado",message:`AtenÃ§Ã£o! O pagamento de ${e} no valor de R$ ${a.toLocaleString("pt-BR")} estÃ¡ atrasado hÃ¡ ${t} dia(s).`,metadata:{paymentId:n,amount:a,employeeName:e}})},S=async(o,e,a)=>{await c(o,{type:"new_employee",title:"ðŸ‘¤ Novo FuncionÃ¡rio Cadastrado",message:`${e} foi adicionado(a) Ã  sua equipe.`,metadata:{employeeId:a,employeeName:e}})},L=async(o,e,a,t)=>{await c(o,{type:"low_balance",title:"âš ï¸ Saldo Baixo",message:`O saldo da plataforma ${e} estÃ¡ baixo: R$ ${a.toLocaleString("pt-BR")}. Considere fazer um depÃ³sito.`,metadata:{platformId:t,balance:a}})},O=async(o,e,a="hoje")=>{await c(o,{type:"high_activity",title:"ðŸ“Š Alta Atividade Detectada",message:`VocÃª teve ${e} transaÃ§Ãµes ${a}. Ã“timo movimento!`,metadata:{transactionCount:e}})},k=Object.freeze(Object.defineProperty({__proto__:null,sendAdminDemotionNotification:E,sendAdminPromotionNotification:_,sendGoalProgressNotification:A,sendGoalReachedNotification:N,sendHighActivityNotification:O,sendLowBalanceNotification:L,sendNewEmployeeNotification:S,sendNotificationToUser:c,sendPaymentOverdueNotification:b,sendPaymentPendingNotification:B,sendPlanChangeNotification:R},Symbol.toStringTag,{value:"Module"}));export{_ as a,E as b,F as c,N as d,A as e,B as f,v as g,b as h,L as i,O as j,R as s,k as u};
