import{j as e,n as be,a8 as we,N as K,p as X,a as q,a3 as O,e as De,o as Ce,i as m}from"./ui-vendor-BKTCjC1N.js";import{r as d,k as Te,u as Se}from"./react-vendor-a_rYd-gI.js";import{D as Y,A as Ee,i as Ae,a as Pe,b as Fe,c as Re,d as ke,e as Ie,f as ze,g as Be}from"./DashboardLayout-q6rxeK_Q.js";import{h as p,i as Le,B as c,C as I,k as ee}from"./index-SqI1anxU.js";import{I as x}from"./input-D95wG3bR.js";import{L as l}from"./label-DZGThxx-.js";import{S as v,a as N,b as y,c as b,d as u}from"./select-B0D5tgNH.js";import{D as ae,b as se,c as te,d as re}from"./dialog-DD9uaM8e.js";import{c as Ve,u as He,g as qe,n as Oe,d as _e,e as Me,o as $e,b as We}from"./useFirestore-CWK9mQXj.js";import"./firebase-vendor-DKIO36wX.js";import"./index-DIdW4MCp.js";import"./chart-vendor-2xH8hKrZ.js";import"./index-CdAzXW5_.js";import"./user-specific.service-C9pIzcyq.js";import"./user-subcollections.service-CeICSZJy.js";const ie=d.forwardRef(({className:o,...n},r)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:r,className:p("w-full caption-bottom text-sm",o),...n})}));ie.displayName="Table";const le=d.forwardRef(({className:o,...n},r)=>e.jsx("thead",{ref:r,className:p("[&_tr]:border-b",o),...n}));le.displayName="TableHeader";const oe=d.forwardRef(({className:o,...n},r)=>e.jsx("tbody",{ref:r,className:p("[&_tr:last-child]:border-0",o),...n}));oe.displayName="TableBody";const Ue=d.forwardRef(({className:o,...n},r)=>e.jsx("tfoot",{ref:r,className:p("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",o),...n}));Ue.displayName="TableFooter";const z=d.forwardRef(({className:o,...n},r)=>e.jsx("tr",{ref:r,className:p("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",o),...n}));z.displayName="TableRow";const w=d.forwardRef(({className:o,...n},r)=>e.jsx("th",{ref:r,className:p("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",o),...n}));w.displayName="TableHead";const j=d.forwardRef(({className:o,...n},r)=>e.jsx("td",{ref:r,className:p("p-4 align-middle [&:has([role=checkbox])]:pr-0",o),...n}));j.displayName="TableCell";const Ze=d.forwardRef(({className:o,...n},r)=>e.jsx("caption",{ref:r,className:p("mt-4 text-sm text-muted-foreground",o),...n}));Ze.displayName="TableCaption";const da=()=>{const{id:o}=Te(),n=Se();be();const{user:r}=Le(),[E,_]=d.useState(""),[D,M]=d.useState(""),[A,$]=d.useState(""),[C,W]=d.useState(""),[ne,P]=d.useState(!1),[de,F]=d.useState(!1),[U,Z]=d.useState(null),[g,R]=d.useState({amount:"",platformId:"",type:"deposit"}),[i,h]=d.useState({name:"",cpf:"",email:"",phone:"",birthDate:"",salary:0,payDay:1,status:"active"}),{data:ce=[]}=Ve(r?.uid||""),s=ce.find(a=>a.id===o),Q=new Date().toLocaleDateString("pt-BR",{timeZone:"America/Sao_Paulo"}).split("/").reverse().join("-"),{data:me=[]}=He(r?.uid||"",Q,Q),he=me.filter(a=>a.employeeId===o),B=qe(),G=Oe(),L=_e(),xe=Me(),V=$e(),ue=()=>{s&&(h({name:s.name,cpf:s.cpf||"",email:s.email||"",phone:s.phone||"",birthDate:s.birthDate||"",salary:s.salary||0,payDay:s.payDay||1,status:s.status||"active"}),P(!0))},pe=async()=>{if(!(!s||!r?.uid)){if(!i.name.trim()){m.error("O nome é obrigatório");return}try{const a={name:i.name.trim(),updatedAt:new Date};i.cpf.trim()&&(a.cpf=i.cpf.trim()),i.email.trim()&&(a.email=i.email.trim()),i.phone.trim()&&(a.phone=i.phone.trim()),i.birthDate&&(a.birthDate=i.birthDate),i.salary>0&&(a.salary=i.salary),i.payDay>0&&(a.payDay=i.payDay),a.status=i.status,await B.mutateAsync({userId:r.uid,id:s.id,data:a}),m.success("Funcionário atualizado com sucesso!"),P(!1)}catch(a){console.error("Erro ao atualizar funcionário:",a),m.error("Erro ao atualizar funcionário. Tente novamente.")}}},je=async()=>{if(!(!s||!r?.uid))try{await G.mutateAsync({userId:r.uid,id:s.id}),m.success("Funcionário excluído com sucesso!"),n("/gestao-funcionarios")}catch(a){console.error("Erro ao excluir funcionário:",a),m.error("Erro ao excluir funcionário. Tente novamente.")}},ge=a=>{Z(a),R({amount:a.amount.toString(),platformId:a.platformId||"",type:a.type}),F(!0)},fe=async()=>{if(!(!U||!r?.uid))try{await V.mutateAsync({userId:r.uid,id:U.id,data:{amount:Number(g.amount),platformId:g.platformId,type:g.type}}),m.success("Transação atualizada com sucesso!"),F(!1),Z(null)}catch(a){console.error("Erro ao atualizar transação:",a),m.error("Erro ao atualizar transação. Tente novamente.")}},{data:f=[]}=We(r?.uid||"");console.log("Platforms loaded:",f),console.log("Deposit platform:",D),console.log("Withdraw platform:",C);const J=he,k=async(a,t,T)=>{if(!(!s||!r?.uid))try{const S={userId:r.uid,employeeId:s.id,platformId:T,type:a,amount:Number(t),date:new Date().toLocaleDateString("pt-BR",{timeZone:"America/Sao_Paulo"}).split("/").reverse().join("-")};console.log("Creating transaction:",S),console.log("Transaction date being saved:",S.date);const ye=await L.mutateAsync(S);console.log("Transaction created with ID:",ye),m.success(`${a==="deposit"?"Depósito":"Saque"} registrado com sucesso!`),a==="deposit"?(_(""),M("")):($(""),W(""))}catch(S){console.error("Erro ao registrar transação:",S),m.error("Erro ao registrar transação. Tente novamente.")}},ve=()=>{if(!E){m.error("Preencha o valor do depósito");return}if(console.log("Attempting deposit with platform:",D),!D){console.log("No platform selected, proceeding without platform"),k("deposit",E,"");return}k("deposit",E,D)},Ne=()=>{if(!A){m.error("Preencha o valor do saque");return}if(console.log("Attempting withdraw with platform:",C),!C){console.log("No platform selected, proceeding without platform"),k("withdraw",A,"");return}k("withdraw",A,C)},H=(a,t)=>{navigator.clipboard.writeText(a),m.success(`${t} copiado!`)};return s?e.jsx(Y,{children:e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>n("/gestao-funcionarios"),children:e.jsx(we,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:s.name}),e.jsx("p",{className:"text-muted-foreground",children:"Perfil do Funcionário"})]}),e.jsxs(c,{variant:"outline",className:"gap-2",onClick:ue,children:[e.jsx(K,{className:"h-4 w-4"}),"Editar"]}),e.jsxs(Ee,{children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(c,{variant:"destructive",className:"gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Excluir"]})}),e.jsxs(Pe,{children:[e.jsxs(Fe,{children:[e.jsx(Re,{children:"Confirmar Exclusão"}),e.jsxs(ke,{children:["Tem certeza que deseja excluir o funcionário ",s.name,"? Esta ação não pode ser desfeita e todas as transações relacionadas serão perdidas."]})]}),e.jsxs(Ie,{children:[e.jsx(ze,{children:"Cancelar"}),e.jsx(Be,{onClick:je,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:G.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Excluindo..."]}):"Excluir"})]})]})]})]}),e.jsx(I,{className:"p-6 shadow-card",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{className:"text-sm text-muted-foreground",children:"CPF"}),e.jsx("p",{className:"text-lg font-semibold",children:s.cpf})]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>H(s.cpf,"CPF"),children:e.jsx(O,{className:"h-4 w-4"})})]}),s.email&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{className:"text-sm text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-lg font-semibold",children:s.email})]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>H(s.email,"Email"),children:e.jsx(O,{className:"h-4 w-4"})})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{className:"text-sm text-muted-foreground",children:"Telefone"}),e.jsx("p",{className:"text-lg font-semibold",children:s.phone})]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>H(s.phone,"Telefone"),children:e.jsx(O,{className:"h-4 w-4"})})]}),s.birthDate&&e.jsxs("div",{children:[e.jsx(l,{className:"text-sm text-muted-foreground",children:"Data de Nascimento"}),e.jsx("p",{className:"text-lg font-semibold",children:new Date(s.birthDate).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx("div",{className:"mt-2",children:e.jsx(ee,{variant:s.status==="active"?"default":"secondary",className:s.status==="active"?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${s.status==="active","bg-white"}`}),s.status==="active"?"Ativo":"Inativo"]})})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{className:"p-6 shadow-card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Registrar Depósito"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Valor (BRL)"}),e.jsx(x,{type:"number",placeholder:"0,00",value:E,onChange:a=>_(a.target.value)})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Plataforma"}),e.jsxs(v,{value:D,onValueChange:M,children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Selecione a plataforma"})}),e.jsx(b,{children:f.map(a=>e.jsx(u,{value:a.id,children:a.name},a.id))})]})]}),e.jsx(c,{onClick:ve,disabled:L.isPending,className:"w-full bg-destructive hover:bg-destructive/90",children:"Registrar Depósito"})]})]}),e.jsxs(I,{className:"p-6 shadow-card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Registrar Saque"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Valor (BRL)"}),e.jsx(x,{type:"number",placeholder:"0,00",value:A,onChange:a=>$(a.target.value)})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Plataforma"}),e.jsxs(v,{value:C,onValueChange:W,children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Selecione a plataforma"})}),e.jsx(b,{children:f.map(a=>e.jsx(u,{value:a.id,children:a.name},a.id))})]})]}),e.jsx(c,{onClick:Ne,disabled:L.isPending,className:"w-full",style:{backgroundColor:"#9333EA"},children:"Registrar Saque"})]})]})]}),e.jsxs(I,{className:"shadow-card",children:[e.jsx("div",{className:"p-6 border-b border-border/50",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Histórico de Movimentações (Hoje)"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ie,{children:[e.jsx(le,{children:e.jsxs(z,{children:[e.jsx(w,{children:"Tipo"}),e.jsx(w,{children:"Plataforma"}),e.jsx(w,{children:"Data/Hora"}),e.jsx(w,{children:"Valor"}),e.jsx(w,{className:"text-right",children:"Ações"})]})}),e.jsx(oe,{children:J.length===0?e.jsx(z,{children:e.jsx(j,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"Nenhuma movimentação hoje"})}):J.map(a=>e.jsxs(z,{children:[e.jsx(j,{children:e.jsx(ee,{variant:a.type==="deposit"?"default":"destructive",children:a.type==="deposit"?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"h-3 w-3"}),"Depósito"]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ce,{className:"h-3 w-3"}),"Saque"]})})}),e.jsx(j,{children:e.jsx("span",{className:"font-semibold",style:{color:f.find(T=>T.id===a.platformId)?.color||"#FF5C00"},children:f.find(T=>T.id===a.platformId)?.name||"N/A"})}),e.jsx(j,{children:new Date(a.createdAt?.toDate?.()||a.date).toLocaleDateString("pt-BR",{timeZone:"America/Sao_Paulo",day:"2-digit",month:"2-digit",year:"numeric"})}),e.jsx(j,{children:e.jsxs("span",{className:a.type==="deposit"?"text-success":"text-destructive",children:[a.type==="deposit"?"+":"-","R$"," ",Number(a.amount).toLocaleString("pt-BR")]})}),e.jsx(j,{className:"text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>ge(a),children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>xe.mutate(a.id),children:e.jsx(X,{className:"h-4 w-4"})})]})})]},a.id))})]})})]}),e.jsx(ae,{open:ne,onOpenChange:P,children:e.jsxs(se,{className:"sm:max-w-[500px]",children:[e.jsxs(te,{children:[e.jsx(re,{children:"Editar Funcionário"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Preencha as informações do funcionário. Apenas o nome é obrigatório."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-name",children:"Nome Completo"}),e.jsx(x,{id:"edit-name",value:i.name,onChange:a=>h(t=>({...t,name:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-cpf",children:"CPF"}),e.jsx(x,{id:"edit-cpf",value:i.cpf,onChange:a=>h(t=>({...t,cpf:a.target.value})),placeholder:"000.000.000-00 (opcional)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-email",children:"E-mail"}),e.jsx(x,{id:"edit-email",type:"email",value:i.email,onChange:a=>h(t=>({...t,email:a.target.value})),placeholder:"email@exemplo.com (opcional)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-phone",children:"Telefone"}),e.jsx(x,{id:"edit-phone",value:i.phone,onChange:a=>h(t=>({...t,phone:a.target.value})),placeholder:"(00) 00000-0000 (opcional)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-birthDate",children:"Data de Nascimento"}),e.jsx(x,{id:"edit-birthDate",type:"date",value:i.birthDate,onChange:a=>h(t=>({...t,birthDate:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-salary",children:"Salário (R$)"}),e.jsx(x,{id:"edit-salary",type:"number",placeholder:"0,00",value:i.salary,onChange:a=>h(t=>({...t,salary:Number(a.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-payDay",children:"Dia do Pagamento"}),e.jsxs(v,{value:i.payDay.toString(),onValueChange:a=>h(t=>({...t,payDay:Number(a)})),children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Selecione o dia"})}),e.jsx(b,{children:Array.from({length:31},(a,t)=>t+1).map(a=>e.jsxs(u,{value:a.toString(),children:[a,"º dia do mês"]},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-status",children:"Status do Funcionário"}),e.jsxs(v,{value:i.status,onValueChange:a=>h(t=>({...t,status:a})),children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Selecione o status"})}),e.jsxs(b,{children:[e.jsx(u,{value:"active",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Ativo"]})}),e.jsx(u,{value:"inactive",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),"Inativo"]})})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>P(!1),children:"Cancelar"}),e.jsx(c,{onClick:pe,disabled:B.isPending,children:B.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Salvando..."]}):"Salvar"})]})]})]})}),e.jsx(ae,{open:de,onOpenChange:F,children:e.jsxs(se,{className:"sm:max-w-[500px]",children:[e.jsx(te,{children:e.jsx(re,{children:"Editar Transação"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit-amount",children:"Valor"}),e.jsx(x,{id:"edit-amount",type:"number",value:g.amount,onChange:a=>R(t=>({...t,amount:a.target.value})),placeholder:"Digite o valor"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit-type",children:"Tipo"}),e.jsxs(v,{value:g.type,onValueChange:a=>R(t=>({...t,type:a})),children:[e.jsx(N,{children:e.jsx(y,{})}),e.jsxs(b,{children:[e.jsx(u,{value:"deposit",children:"Depósito"}),e.jsx(u,{value:"withdraw",children:"Saque"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit-platform",children:"Plataforma"}),e.jsxs(v,{value:g.platformId,onValueChange:a=>R(t=>({...t,platformId:a})),children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Selecione uma plataforma"})}),e.jsx(b,{children:f.map(a=>e.jsx(u,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(c,{variant:"outline",onClick:()=>F(!1),children:"Cancelar"}),e.jsxs(c,{onClick:fe,disabled:V.isPending,children:[V.isPending&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Salvar"]})]})]})]})})]})}):e.jsx(Y,{children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Carregando..."})})})};export{da as default};
