import{n as A,u as H,Y as w,i as S,j as e,p as O,a8 as V}from"./ui-vendor-CYAqJ0RG.js";import{D as Q}from"./DashboardLayout-B3XyjcMy.js";import{I as R}from"./input-J7GhaNSr.js";import{h as K,B as M,j as L}from"./index-LiAbW-2G.js";import{S as f,a as g,b,c as j,d as u}from"./select-Bd9uzrFY.js";import{SurebetService as D}from"./surebet.service-CC8W08RU.js";import{b as U,c as C}from"./user-specific.service-C1DLMu9g.js";import{f as v}from"./format-G_C_Ywev.js";import{p as $}from"./pt-BR-Crt2EcWv.js";import{u as z}from"./react-vendor-a_rYd-gI.js";import"./user-notifications.service-CAzP-qxP.js";import"./firebase-vendor-BUxvNq0f.js";import"./index-DMSHDzho.js";import"./chart-vendor-ctXMAO2v.js";import"./index-CdAzXW5_.js";import"./user-subcollections.service-B4HigrO8.js";import"./en-US-xOTpc2KN.js";const G=({calculatorData:y})=>{const{user:i}=K(),c=A(),{data:x=[],isLoading:T}=H({queryKey:["surebet-records",i?.uid],queryFn:()=>D.getRecords(i?.uid||""),enabled:!!i?.uid}),F=w({mutationFn:({id:a,data:t})=>D.updateRecord(i?.uid||"",a,t),onSuccess:()=>{c.invalidateQueries({queryKey:["surebet-records",i?.uid]})}}),I=w({mutationFn:async a=>{if(!i?.uid)return;const t=x.find(r=>r.id===a);if(!t)throw new Error("Registro não encontrado");const n=x.filter(r=>r.operationId===t.operationId),o=n.find(r=>r.transactionId);if(o?.transactionId){const d=n[0]?.profit||0;await U.deleteTransaction(i.uid,o.transactionId);const h=t.registrationDate instanceof Date?t.registrationDate:t.registrationDate?.toDate?t.registrationDate.toDate():new Date(t.registrationDate),p=v(h,"yyyy-MM-dd"),s=await C.getDailySummaryByDate(i.uid,p);if(s){const m=Math.max(0,(s.profit||s.margin||0)-d),k=Math.max(0,(s.totalDeposits||0)-d);await C.updateDailySummary(i.uid,s.id,{totalDeposits:k,profit:m,margin:m,transactionCount:Math.max(0,(s.transactionCount||0)-1),updatedAt:new Date})}c.invalidateQueries({queryKey:["transactions",i.uid]}),c.invalidateQueries({queryKey:["daily-summaries",i.uid]})}for(const r of n)await D.deleteRecord(i.uid,r.id)},onSuccess:()=>{c.invalidateQueries({queryKey:["surebet-records",i?.uid]}),S.success("Operação removida!")},onError:a=>{console.error("Erro ao excluir registro:",a),S.error("Erro ao excluir operação")}}),q=x.reduce((a,t)=>(a[t.operationId]||(a[t.operationId]=[]),a[t.operationId].push(t),a),{}),N=Object.values(q).sort((a,t)=>{const n=a[0]?.registrationDate instanceof Date?a[0].registrationDate.getTime():new Date(a[0]?.registrationDate||0).getTime();return(t[0]?.registrationDate instanceof Date?t[0].registrationDate.getTime():new Date(t[0]?.registrationDate||0).getTime())-n}),l=(a,t,n)=>{F.mutate({id:a,data:{[t]:n}})},B=a=>{confirm("Deseja realmente excluir esta operação? O lucro será removido do dashboard.")&&I.mutate(a)},E=["Futebol","Basquete","Tênis","Vôlei","Futebol Americano","Baseball","Hóquei","Outro"],P=["ML","AH","OU","1X2","BTTS","Outro"];return T?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Carregando..."}):e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50",children:[e.jsx("th",{className:"p-3 text-left text-sm font-semibold border-r",children:"Data/Hora Registro"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold border-r",children:"Data/Hora Jogo"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold border-r",children:"Esporte"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold border-r",children:"Evento"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold border-r",children:"Casa + Mercado"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold border-r",children:"Odd"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold border-r",children:"Aposta (Stake)"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold border-r",children:"EV%"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold border-r",children:"Lucro"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold border-r",children:"Status"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold",children:"Ações"})]})}),e.jsxs("tbody",{children:[N.map(a=>a.map((t,n)=>{let o;t.registrationDate instanceof Date?o=t.registrationDate:t.registrationDate&&typeof t.registrationDate=="object"&&"toDate"in t.registrationDate?o=t.registrationDate.toDate():typeof t.registrationDate=="string"||typeof t.registrationDate=="number"?o=new Date(t.registrationDate):o=new Date;let r;t.gameDate instanceof Date?r=t.gameDate:t.gameDate&&typeof t.gameDate=="object"&&"toDate"in t.gameDate?r=t.gameDate.toDate():typeof t.gameDate=="string"||typeof t.gameDate=="number"?r=new Date(t.gameDate):r=void 0;const d=(t.evPercent||0)>0,h=t.status==="green",p=t.status==="red";return e.jsxs("tr",{className:`border-b hover:bg-muted/30 ${h?"bg-green-50 dark:bg-green-950/20":p?"bg-red-50 dark:bg-red-950/20":d?"bg-success/5":"bg-destructive/5"}`,children:[e.jsx("td",{className:"p-3 text-sm border-r",children:v(o,"dd/MM/yyyy 'às' HH:mm",{locale:$})}),e.jsx("td",{className:"p-3 border-r",children:e.jsx(R,{type:"datetime-local",value:r?v(r,"yyyy-MM-dd'T'HH:mm"):"",onChange:s=>{const m=s.target.value?new Date(s.target.value):void 0;l(t.id,"gameDate",m)},className:"w-full text-sm"})}),e.jsx("td",{className:"p-3 border-r",children:e.jsxs(f,{value:t.sport||"",onValueChange:s=>l(t.id,"sport",s),children:[e.jsx(g,{className:"w-full text-sm",children:e.jsx(b,{placeholder:"Selecione"})}),e.jsx(j,{children:E.map(s=>e.jsx(u,{value:s,children:s},s))})]})}),e.jsx("td",{className:"p-3 border-r",children:e.jsx(R,{type:"text",value:t.event||"",onChange:s=>l(t.id,"event",s.target.value),placeholder:"Nome do evento",className:"w-full text-sm"})}),e.jsx("td",{className:"p-3 border-r",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:t.house}),e.jsxs(f,{value:t.market||"",onValueChange:s=>l(t.id,"market",s),children:[e.jsx(g,{className:"w-full text-xs h-8",children:e.jsx(b,{placeholder:"Mercado"})}),e.jsx(j,{children:P.map(s=>e.jsx(u,{value:s,children:s},s))})]})]})}),e.jsx("td",{className:"p-3 text-sm border-r text-center",children:t.odd.toFixed(3)}),e.jsxs("td",{className:"p-3 text-sm border-r text-right",children:["R$ ",t.stake.toFixed(2)]}),e.jsxs("td",{className:`p-3 text-sm border-r text-center font-bold ${d?"text-success":"text-destructive"}`,children:[t.evPercent>=0?"+":"",t.evPercent.toFixed(2),"%"]}),e.jsxs("td",{className:"p-3 text-sm border-r text-right font-bold text-success",children:["R$ ",t.profit.toFixed(2)]}),e.jsx("td",{className:"p-3 border-r",children:e.jsxs(f,{value:t.status||"",onValueChange:s=>l(t.id,"status",s||void 0),children:[e.jsx(g,{className:"w-full text-sm",children:e.jsx(b,{placeholder:"-"})}),e.jsxs(j,{children:[e.jsx(u,{value:"green",children:"Green"}),e.jsx(u,{value:"red",children:"Red"})]})]})}),e.jsx("td",{className:"p-3",children:e.jsx(M,{variant:"ghost",size:"icon",onClick:()=>B(t.id),className:"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10",children:e.jsx(O,{className:"h-4 w-4"})})})]},t.id)})),N.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"p-8 text-center text-muted-foreground",children:'Nenhum registro ainda. Use a calculadora acima e clique em "Planilhar" para adicionar operações.'})})]})]})})})},me=()=>{const y=z();return e.jsx(Q,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(L,{className:"rounded-full bg-primary/10 px-4 py-1 text-[0.65rem] font-semibold uppercase tracking-[0.35em] text-primary mb-4",children:"Surebet"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{variant:"ghost",size:"icon",onClick:()=>y("/surebet"),className:"h-8 w-8",children:e.jsx(V,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-3xl font-bold",children:"Planilha de Registros"})]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Visualize e gerencie todas as suas operações de Surebet"})]})}),e.jsx(G,{})]})})};export{me as default};
