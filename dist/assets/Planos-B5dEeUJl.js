import{Y as y,j as e,T as C,a as D,i as v,m as o,U as h,e as P,C as R,S as w,_ as E,Z as N}from"./ui-vendor-CYAqJ0RG.js";import{r as p}from"./react-vendor-a_rYd-gI.js";import{D as S}from"./DashboardLayout-B3XyjcMy.js";import{n as L,B as A,h as B,i as T,j as f,C as U}from"./index-LiAbW-2G.js";import{S as H}from"./switch-DAVPgkOz.js";import{e as b}from"./env-14fk--Ss.js";import{s as I,v as M,w as _}from"./firebase-vendor-BUxvNq0f.js";import{A as $,b as F,a as q}from"./alert-BhNgEuP2.js";import"./user-specific.service-C1DLMu9g.js";import"./user-subcollections.service-B4HigrO8.js";import"./user-notifications.service-CAzP-qxP.js";import"./input-J7GhaNSr.js";import"./index-DMSHDzho.js";import"./chart-vendor-ctXMAO2v.js";import"./index-CdAzXW5_.js";function O(){return y({mutationFn:async t=>{console.log("üîç Hook - URL da API:",b.API_URL),console.log("üîç Hook - Payload:",t);try{const a=await fetch(`${b.API_URL}/createPaymentPreference`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("üîç Hook - Status da resposta:",a.status),!a.ok){let l;try{l=await a.json()}catch{l={error:a.statusText}}throw console.error("‚ùå Hook - Erro da API:",l),new Error(l.error||`Erro HTTP ${a.status}: ${a.statusText}`)}const n=await a.json();return console.log("‚úÖ Hook - Resposta da API:",n),n}catch(a){throw console.error("‚ùå Hook - Erro na fetch:",a),a}},onError:t=>{console.error("‚ùå Hook - Erro na mutation:",t)},onSuccess:t=>{console.log("‚úÖ Hook - Mutation bem-sucedida:",t)}})}async function V(t,a,n,l){try{const r={userId:t,userEmail:a.toLowerCase(),selectedPlan:n.toLowerCase(),billingType:l,timestamp:I(),status:"pending",ownerId:t},m=await M(_(L,"plan_selections"),r);return console.log("‚úÖ Log de sele√ß√£o de plano criado:",m.id,{userId:t,userEmail:a,selectedPlan:n,billingType:l}),m.id}catch(r){return console.error("‚ùå Erro ao criar log de sele√ß√£o de plano:",r),null}}const z=({onClose:t})=>{const[a,n]=p.useState(!1),[l,r]=p.useState(!1);p.useEffect(()=>{(async()=>{try{const j=await fetch("https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",{method:"HEAD",mode:"no-cors"});n(!1)}catch{n(!0)}})()},[]),p.useEffect(()=>{localStorage.getItem("adBlockerWarningDismissed")&&r(!0)},[]);const m=()=>{r(!0),localStorage.setItem("adBlockerWarningDismissed","true"),t?.()};return l||!a?null:e.jsxs($,{className:"border-amber-500 bg-amber-500/10 mb-4",children:[e.jsx(C,{className:"h-4 w-4 text-amber-500"}),e.jsx(F,{className:"text-amber-500 font-semibold",children:"Aviso: Bloqueador de An√∫ncios Detectado"}),e.jsxs(q,{className:"mt-2 space-y-2",children:[e.jsx("p",{className:"text-sm",children:"Seu bloqueador de an√∫ncios pode interferir com o processo de pagamento do Mercado Pago."}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx("p",{className:"font-semibold",children:"Para resolver:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:[e.jsx("li",{children:"Desabilite temporariamente o bloqueador de an√∫ncios"}),e.jsx("li",{children:"Ou adicione o Mercado Pago √† lista de exce√ß√µes"}),e.jsx("li",{children:"Ou use o modo de navega√ß√£o an√¥nima"})]})]}),e.jsx("div",{className:"flex gap-2 mt-3",children:e.jsx(A,{variant:"outline",size:"sm",onClick:m,className:"h-8",children:"Entendi"})})]})]})},ne=()=>{const{user:t}=B(),{currentPlan:a}=T(),[n,l]=p.useState(!1),r=O(),m={free:0,standard:1,medium:2,ultimate:3},u=s=>{const i=m[a]||0,c=m[s]||0,d=c<i;return console.log("üîç Debug Bot√£o - isPlanLower:",{planValue:s,currentPlan:a,currentLevel:i,planLevel:c,isLower:d}),d},x={free:[{text:"Dashboard b√°sico",icon:o},{text:"Resumo do dia",icon:o},{text:"Cadastro de 1 funcion√°rio",icon:h},{text:"Registro de transa√ß√µes do dia atual",icon:o},{text:"Dep√≥sitos e saques b√°sicos",icon:o},{text:"Visualiza√ß√£o do calend√°rio (m√™s atual)",icon:o},{text:"Calend√°rio Anterior",icon:o,blocked:!0},{text:"Pagamentos",icon:o,blocked:!0},{text:"Relat√≥rios",icon:o,blocked:!0},{text:"Saldo de Contas",icon:o,blocked:!0},{text:"Hist√≥rico",icon:o,blocked:!0}],standard:[{text:"Dashboard b√°sico",icon:o},{text:"Resumo do dia",icon:o},{text:"Cadastro de at√© 5 funcion√°rios",icon:h},{text:"Registro de transa√ß√µes do dia atual",icon:o},{text:"Dep√≥sitos e saques",icon:o},{text:"Relat√≥rios b√°sicos",icon:P},{text:"Visualiza√ß√£o do calend√°rio (m√™s atual)",icon:o},{text:"Suporte por email",icon:o},{text:"Calend√°rio Anterior",icon:o,blocked:!0},{text:"Pagamentos",icon:o,blocked:!0},{text:"Saldo de Contas",icon:o,blocked:!0},{text:"Hist√≥rico",icon:o,blocked:!0}],medium:[{text:"Dashboard completo",icon:o},{text:"Resumo do dia",icon:o},{text:"Cadastro de at√© 10 funcion√°rios",icon:h},{text:"Registro de transa√ß√µes",icon:o},{text:"Dep√≥sitos e saques",icon:o},{text:"Calend√°rio Anterior",icon:o},{text:"Pagamentos",icon:o},{text:"Relat√≥rios avan√ßados",icon:P},{text:"Saldo de Contas",icon:o},{text:"Hist√≥rico completo",icon:o}],ultimate:[{text:"Dashboard completo e avan√ßado",icon:o},{text:"Resumo do dia",icon:o},{text:"Cadastro de at√© 50 funcion√°rios",icon:h},{text:"Registro de transa√ß√µes ilimitadas",icon:o},{text:"Dep√≥sitos e saques",icon:o},{text:"Calend√°rio Anterior",icon:o},{text:"Pagamentos",icon:o},{text:"Relat√≥rios avan√ßados",icon:P},{text:"Saldo de Contas",icon:o},{text:"Hist√≥rico completo",icon:o},{text:"CPA Chinesa",icon:R,exclusive:!0},{text:"Painel Avan√ßado",icon:w,exclusive:!0},{text:"Dutchuing Bot",icon:E,exclusive:!0},{text:"Integra√ß√µes avan√ßadas",icon:N,exclusive:!0},{text:"API personalizada",icon:N,exclusive:!0},{text:"Suporte priorit√°rio",icon:o,exclusive:!0},{text:"Suporte dedicado",icon:o,exclusive:!0}]},j=async s=>{if(!t){v.error("Voc√™ precisa estar logado para assinar um plano");return}if(s==="free"){v.error("O plano Free j√° est√° ativo");return}try{console.log("üîç Debug - Vari√°veis de ambiente:",{API_URL:b.API_URL,PUBLIC_KEY:b.MERCADO_PAGO_PUBLIC_KEY}),console.log("üîç Debug - Dados do payload:",{userId:t.uid,userEmail:t.email||"",userName:t.displayName||t.email?.split("@")[0]||"Usu√°rio",planId:s,billingType:n?"annual":"monthly"});const i=await V(t.uid,t.email||"",s,n?"annual":"monthly");console.log("üìù Log de sele√ß√£o criado:",i);const c=await r.mutateAsync({userId:t.uid,userEmail:t.email||"",userName:t.displayName||t.email?.split("@")[0]||"Usu√°rio",planId:s,billingType:n?"annual":"monthly"});console.log("‚úÖ Prefer√™ncia criada:",c);const d=c.checkout_url||c.init_point||c.sandbox_init_point;if(!d)throw console.error("‚ùå Nenhuma URL de checkout dispon√≠vel:",c),r.reset(),new Error("URL de checkout n√£o retornada pelo Mercado Pago");console.log("üîó Redirecionando para:",d),r.reset(),setTimeout(()=>{window.location.href=d},100)}catch(i){console.error("‚ùå Erro ao criar prefer√™ncia:",i);let d=i instanceof Error?i.message:"Erro desconhecido";if(i instanceof Error&&"response"in i){const g=i.response;g?.data?.message?d=g.data.message:g?.data?.error?.message&&(d=g.data.error.message)}v.error(`Erro ao processar pagamento: ${d}`),setTimeout(()=>{r.reset()},100)}},k=[{name:"Free",value:"free",price:0,period:"Gr√°tis",annualPrice:0,features:x.free,current:a==="free",popular:!1,description:"Testar o sistema"},{name:"Standard",value:"standard",price:34.9,period:"m√™s",annualPrice:356.76,features:x.standard,current:a==="standard",popular:!1,description:"Pequenos neg√≥cios"},{name:"Medium",value:"medium",price:49.9,period:"m√™s",annualPrice:509.16,features:x.medium,current:a==="medium",popular:!0,description:"M√©dias empresas"},{name:"Ultimate",value:"ultimate",price:74.9,period:"m√™s",annualPrice:764.76,features:x.ultimate,current:a==="ultimate",popular:!1,description:"Grandes empresas"}];return e.jsx(S,{children:e.jsxs("div",{className:"space-y-8 animate-fade-in",children:[e.jsx(z,{}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(f,{className:"rounded-full bg-primary/10 px-4 py-1 text-[0.65rem] font-semibold uppercase tracking-[0.35em] text-primary mb-4 mx-auto",children:"Planos"}),e.jsx("h1",{className:"text-4xl font-bold",children:"Escolha seu Plano"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Selecione o plano ideal para o seu neg√≥cio"}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("span",{className:n?"text-muted-foreground":"font-semibold",children:"Mensal"}),e.jsx(H,{checked:n,onCheckedChange:l}),e.jsxs("span",{className:n?"font-semibold":"text-muted-foreground",children:["Anual",e.jsx(f,{variant:"default",className:"ml-2",children:"15% OFF"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:k.map(s=>e.jsxs(U,{className:`
                p-6 relative shadow-card card-hover flex flex-col h-full
                ${s.popular?"border-primary border-2":""}
                ${u(s.value)?"opacity-60":""}
              `,children:[s.popular&&e.jsx(f,{className:"absolute -top-3 left-1/2 -translate-x-1/2",children:"Mais Popular"}),s.current&&e.jsx(f,{variant:"outline",className:"absolute -top-3 left-1/2 -translate-x-1/2",children:"Plano Atual"}),e.jsxs("div",{className:"flex flex-col h-full space-y-6",children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-4xl font-bold",children:["R$ ",(n?s.annualPrice/12:s.price).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),s.price>0&&e.jsxs("span",{className:"text-muted-foreground",children:["/",s.period]})]}),n&&s.price>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Valor anual: R$ ",s.annualPrice.toLocaleString("pt-BR",{minimumFractionDigits:2}),e.jsx("br",{}),"Economia de R$ ",(s.price*12-s.annualPrice).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),e.jsx("div",{className:"flex-grow space-y-3",children:s.features.map((i,c)=>e.jsxs("div",{className:"flex items-start gap-2",children:[i.blocked?e.jsx("div",{className:"h-5 w-5 shrink-0 mt-0.5 rounded-full border-2 border-muted-foreground/30 flex items-center justify-center",children:e.jsx("div",{className:"h-2 w-2 rounded-full bg-muted-foreground/30"})}):e.jsx(i.icon,{className:`h-5 w-5 shrink-0 mt-0.5 ${i.exclusive?"text-primary":"text-success"}`}),e.jsxs("span",{className:`text-sm ${i.blocked?"text-muted-foreground/60":""} ${i.exclusive?"text-primary font-medium":""}`,children:[i.text,i.exclusive&&e.jsx("span",{className:"ml-1 text-xs",children:"(exclusivo)"})]})]},c))}),e.jsx("div",{className:"flex-shrink-0",children:(()=>{const i=s.current||r.isPending||u(s.value),c={isCurrent:s.current,isPending:r.isPending,isError:r.isError,isLower:u(s.value)};return s.name==="Standard"&&console.log(`üîç Debug Bot√£o [${s.name}]:`,{disabled:i,reasons:c,currentPlan:a,planValue:s.value,mutationState:{isPending:r.isPending,isError:r.isError,error:r.error}}),e.jsx(A,{className:"w-full",variant:s.current?"outline":"default",disabled:i,onClick:()=>{!s.current&&!u(s.value)&&!r.isPending&&(r.isError?(console.log("üîÑ Resetando mutation ap√≥s erro"),r.reset(),setTimeout(()=>{j(s.value)},100)):j(s.value))},children:r.isPending?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),"Redirecionando..."]}):s.current?"Plano Atual":u(s.value)?"Plano Menor":r.isError?"Tentar Novamente":"Assinar"})})()})]})]},s.name))}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:[e.jsx("p",{children:"Todos os planos incluem 7 dias de teste gr√°tis"}),e.jsx("p",{children:"Cancele a qualquer momento, sem taxas adicionais"})]})]})})};export{ne as default};
