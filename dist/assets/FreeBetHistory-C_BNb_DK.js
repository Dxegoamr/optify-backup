const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/user-specific.service-C1DLMu9g.js","assets/user-subcollections.service-B4HigrO8.js","assets/firebase-vendor-BUxvNq0f.js","assets/index-LiAbW-2G.js","assets/ui-vendor-CYAqJ0RG.js","assets/react-vendor-a_rYd-gI.js","assets/chart-vendor-ctXMAO2v.js","assets/index-RBW8IlQ1.css"])))=>i.map(i=>d[i]);
import{h as _,B as u,C as f,q as H,r as R,j as B,t as p,_ as j}from"./index-LiAbW-2G.js";import{n as q,u as I,j as e,a8 as O,p as k,g as L,i as g}from"./ui-vendor-CYAqJ0RG.js";import{u as M,r as y}from"./react-vendor-a_rYd-gI.js";import{D,A as Q,h as z,i as K,j as P,k as V,l as $,m as U,n as G}from"./DashboardLayout-B3XyjcMy.js";import{F as N}from"./freebet.service-9e18y7QZ.js";import{b as v}from"./user-specific.service-C1DLMu9g.js";import{f as W}from"./format-G_C_Ywev.js";import{p as J}from"./pt-BR-Crt2EcWv.js";import"./chart-vendor-ctXMAO2v.js";import"./firebase-vendor-BUxvNq0f.js";import"./user-notifications.service-CAzP-qxP.js";import"./input-J7GhaNSr.js";import"./index-DMSHDzho.js";import"./user-subcollections.service-B4HigrO8.js";import"./en-US-xOTpc2KN.js";const ue=()=>{const x=M(),{user:r}=_(),n=q(),[A,c]=y.useState(!1),[o,d]=y.useState(null),{data:C=[],isLoading:b}=I({queryKey:["freebet-history",r?.uid],queryFn:()=>N.getHistory(r?.uid||""),enabled:!!r?.uid}),m=C.map(t=>{const s=t.closedAt instanceof Date?t.closedAt:t.closedAt?.toDate?t.closedAt.toDate():new Date(t.closedAt);return{...t,closedAtDate:s}}).sort((t,s)=>{const l=t.closedAtDate instanceof Date&&!isNaN(t.closedAtDate.getTime())?t.closedAtDate.getTime():0;return(s.closedAtDate instanceof Date&&!isNaN(s.closedAtDate.getTime())?s.closedAtDate.getTime():0)-l}),w=t=>({totalApostado:t.totalApostado||0,retorno:t.retorno||0,totalConversaoSaldo:t.totalConversaoSaldo||0,lucroGeral:t.lucro||0,funcionariosCount:t.funcionarios?.length||0}),T=t=>{d(t),c(!0)},S=async()=>{if(!(!r?.uid||!o))try{let t=null;if(o.transactionId)try{t=(await v.getTransactions(r.uid,1e3)).find(i=>i.id===o.transactionId)}catch(a){console.error("Erro ao buscar transação:",a)}const{UserDailySummaryService:s}=await j(async()=>{const{UserDailySummaryService:a}=await import("./user-specific.service-C1DLMu9g.js").then(i=>i.u);return{UserDailySummaryService:a}},__vite__mapDeps([0,1,2,3,4,5,6,7])),{getCurrentDateStringInSaoPaulo:l}=await j(async()=>{const{getCurrentDateStringInSaoPaulo:a}=await import("./index-LiAbW-2G.js").then(i=>i.O);return{getCurrentDateStringInSaoPaulo:a}},__vite__mapDeps([3,4,5,6,2,7])),h=t?.date||(o.closedAt instanceof Date?o.closedAt.toISOString().split("T")[0]:o.closedAt?.toDate?o.closedAt.toDate().toISOString().split("T")[0]:l());if(o.lucro!==void 0)try{const a=await s.getDailySummaryByDate(r.uid,h);if(a){const i=o.lucro||0,E=i>0?i:0,F=i<0?Math.abs(i):0;await s.updateDailySummary(r.uid,a.id,{totalDeposits:Math.max(0,(a.totalDeposits||0)-E),totalWithdraws:Math.max(0,(a.totalWithdraws||0)-F),profit:(a.profit||a.margin||0)-i,margin:(a.profit||a.margin||0)-i,transactionCount:Math.max(0,(a.transactionCount||0)-1),updatedAt:new Date})}}catch(a){console.error("Erro ao atualizar resumo diário:",a)}if(o.transactionId)try{await v.deleteTransaction(r.uid,o.transactionId)}catch(a){console.error("Erro ao excluir transação vinculada:",a)}await N.deleteHistoryEntry(r.uid,o.id),n.invalidateQueries({queryKey:["freebet-history",r.uid]}),n.invalidateQueries({queryKey:["firebase-transactions",r.uid]}),n.invalidateQueries({queryKey:["firebase-all-daily-summaries",r.uid]}),n.invalidateQueries({queryKey:["firebase-daily-summaries",r.uid]}),g.success("Registro removido do histórico!"),c(!1),d(null)}catch(t){console.error("Erro ao excluir histórico:",t),g.error("Erro ao excluir histórico. Tente novamente.")}};return b?e.jsx(D,{children:e.jsx("div",{className:"flex h-96 items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Carregando..."})})}):e.jsxs(D,{children:[e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>x("/freebet"),children:e.jsx(O,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Histórico de Operações FreeBet"}),e.jsx("p",{className:"text-muted-foreground",children:"Visualize ou exclua suas operações anteriores"})]})]})}),m.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Histórico de Operações"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:m.map(t=>{const s=w(t),l=s.lucroGeral;return e.jsxs(f,{className:"relative opacity-90",children:[e.jsx(H,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 rounded-full",style:{backgroundColor:t.platformColor}}),t.platformName]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Fechada em"," ",t.closedAtDate instanceof Date&&!isNaN(t.closedAtDate.getTime())?W(t.closedAtDate,"dd/MM/yyyy 'às' HH:mm",{locale:J}):"Data desconhecida"]})]}),e.jsx(B,{variant:"outline",className:"bg-gray-50 text-gray-700 border-gray-200",children:"Fechada"})]})}),e.jsxs(p,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Funcionários:"}),e.jsx("span",{className:"font-medium",children:s.funcionariosCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Apostado:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",s.totalApostado.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Retorno Conta Vencedora:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",s.retorno.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Conversão Saldo:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",s.totalConversaoSaldo.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Lucro Fechado:"}),e.jsxs("span",{className:`font-bold ${l>=0?"text-green-600":"text-red-600"}`,children:[l>=0?"+":"","R$ ",l.toFixed(2)]})]})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(u,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>T(t),children:e.jsx(k,{className:"h-4 w-4"})})})]})]},t.id)})})]}),m.length===0&&e.jsx(f,{children:e.jsxs(p,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(L,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Nenhuma operação fechada encontrada"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Feche uma operação para que ela apareça no histórico"}),e.jsx(u,{className:"mt-4",onClick:()=>x("/freebet"),children:"Voltar para FreeBet"})]})})]}),e.jsx(Q,{open:A,onOpenChange:c,children:e.jsxs(z,{children:[e.jsxs(K,{children:[e.jsx(P,{children:"Excluir Registro do Histórico"}),e.jsx(V,{children:"Tem certeza que deseja excluir este registro? Esta ação não pode ser desfeita."})]}),e.jsxs($,{children:[e.jsx(U,{onClick:()=>d(null),children:"Cancelar"}),e.jsx(G,{onClick:S,className:"bg-red-600 hover:bg-red-700",children:"Excluir"})]})]})})]})};export{ue as default};
