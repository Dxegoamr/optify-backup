import{j as e,n as be,a8 as De,N as K,p as X,a as q,a3 as O,e as we,o as Ce,i as m}from"./ui-vendor-COgSaoh6.js";import{r as d,k as Te,u as Se}from"./react-vendor-a_rYd-gI.js";import{D as Y,A as Ae,i as Ee,a as Pe,b as Fe,c as Re,d as ke,e as Ie,f as Be,g as ze}from"./DashboardLayout-gNRGy55i.js";import{h as g,i as Le,B as c,C as I,k as ee}from"./index-CpWZ38xQ.js";import{I as x}from"./input-QpeNTTno.js";import{L as l}from"./label-D3vsPjsu.js";import{S as y,a as b,b as D,c as w,d as j}from"./select-BCvixRJf.js";import{D as ae,b as se,c as te,d as re}from"./dialog-C2zfgNcX.js";import{c as Ve,u as He,g as qe,n as Oe,d as _e,e as $e,o as Me,b as We}from"./useFirestore-CBeuVY0f.js";import"./firebase-vendor-BE8L9dHK.js";import"./index-Ba2OgRVY.js";import"./chart-vendor-2xH8hKrZ.js";import"./index-CdAzXW5_.js";import"./user-specific.service-BRXRLJrk.js";import"./user-subcollections.service-Be66DGXL.js";const ie=d.forwardRef(({className:o,...n},r)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:r,className:g("w-full caption-bottom text-sm",o),...n})}));ie.displayName="Table";const le=d.forwardRef(({className:o,...n},r)=>e.jsx("thead",{ref:r,className:g("[&_tr]:border-b",o),...n}));le.displayName="TableHeader";const oe=d.forwardRef(({className:o,...n},r)=>e.jsx("tbody",{ref:r,className:g("[&_tr:last-child]:border-0",o),...n}));oe.displayName="TableBody";const Ze=d.forwardRef(({className:o,...n},r)=>e.jsx("tfoot",{ref:r,className:g("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",o),...n}));Ze.displayName="TableFooter";const B=d.forwardRef(({className:o,...n},r)=>e.jsx("tr",{ref:r,className:g("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",o),...n}));B.displayName="TableRow";const C=d.forwardRef(({className:o,...n},r)=>e.jsx("th",{ref:r,className:g("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",o),...n}));C.displayName="TableHead";const f=d.forwardRef(({className:o,...n},r)=>e.jsx("td",{ref:r,className:g("p-4 align-middle [&:has([role=checkbox])]:pr-0",o),...n}));f.displayName="TableCell";const Ue=d.forwardRef(({className:o,...n},r)=>e.jsx("caption",{ref:r,className:g("mt-4 text-sm text-muted-foreground",o),...n}));Ue.displayName="TableCaption";const da=()=>{const{id:o}=Te(),n=Se();be();const{user:r}=Le(),[A,_]=d.useState(""),[T,$]=d.useState(""),[E,M]=d.useState(""),[S,W]=d.useState(""),[ne,P]=d.useState(!1),[de,F]=d.useState(!1),[Z,U]=d.useState(null),[v,R]=d.useState({amount:"",platformId:"",type:"deposit"}),[i,h]=d.useState({name:"",cpf:"",email:"",phone:"",birthDate:"",salary:0,payDay:1,status:"active"}),{data:ce=[]}=Ve(r?.uid||""),t=ce.find(a=>a.id===o),Q=new Date().toLocaleDateString("pt-BR",{timeZone:"America/Sao_Paulo"}).split("/").reverse().join("-"),{data:me=[]}=He(r?.uid||"",Q,Q),he=me.filter(a=>a.employeeId===o&&(!a.description||!a.description.includes("Ajuste manual de saldo"))).sort((a,s)=>{const u=a.createdAt?.toDate?.()||new Date(a.createdAt||a.date);return(s.createdAt?.toDate?.()||new Date(s.createdAt||s.date)).getTime()-u.getTime()}),z=qe(),G=Oe(),L=_e(),ue=$e(),V=Me(),xe=()=>{t&&(h({name:t.name,cpf:t.cpf||"",email:t.email||"",phone:t.phone||"",birthDate:t.birthDate||"",salary:t.salary||0,payDay:t.payDay||1,status:t.status||"active"}),P(!0))},pe=async()=>{if(!(!t||!r?.uid)){if(!i.name.trim()){m.error("O nome é obrigatório");return}try{const a={name:i.name.trim(),updatedAt:new Date};i.cpf.trim()&&(a.cpf=i.cpf.trim()),i.email.trim()&&(a.email=i.email.trim()),i.phone.trim()&&(a.phone=i.phone.trim()),i.birthDate&&(a.birthDate=i.birthDate),i.salary>0&&(a.salary=i.salary),i.payDay>0&&(a.payDay=i.payDay),a.status=i.status,await z.mutateAsync({userId:r.uid,id:t.id,data:a}),m.success("Funcionário atualizado com sucesso!"),P(!1)}catch(a){console.error("Erro ao atualizar funcionário:",a),m.error("Erro ao atualizar funcionário. Tente novamente.")}}},je=async()=>{if(!(!t||!r?.uid))try{await G.mutateAsync({userId:r.uid,id:t.id}),m.success("Funcionário excluído com sucesso!"),n("/gestao-funcionarios")}catch(a){console.error("Erro ao excluir funcionário:",a),m.error("Erro ao excluir funcionário. Tente novamente.")}},ge=a=>{U(a),R({amount:a.amount.toString(),platformId:a.platformId||"",type:a.type}),F(!0)},fe=async()=>{if(!(!Z||!r?.uid))try{await V.mutateAsync({userId:r.uid,id:Z.id,data:{amount:Number(v.amount),platformId:v.platformId,type:v.type}}),m.success("Transação atualizada com sucesso!"),F(!1),U(null)}catch(a){console.error("Erro ao atualizar transação:",a),m.error("Erro ao atualizar transação. Tente novamente.")}},{data:N=[]}=We(r?.uid||"");console.log("Platforms loaded:",N),console.log("Deposit platform:",T),console.log("Withdraw platform:",S);const J=he,k=async(a,s,u)=>{if(!(!t||!r?.uid))try{const p={userId:r.uid,employeeId:t.id,platformId:u,type:a,amount:Number(s),date:new Date().toLocaleDateString("pt-BR",{timeZone:"America/Sao_Paulo"}).split("/").reverse().join("-")};console.log("Creating transaction:",p),console.log("Transaction date being saved:",p.date);const ye=await L.mutateAsync(p);console.log("Transaction created with ID:",ye),m.success(`${a==="deposit"?"Depósito":"Saque"} registrado com sucesso!`),a==="deposit"?(_(""),$("")):(M(""),W(""))}catch(p){console.error("Erro ao registrar transação:",p),m.error("Erro ao registrar transação. Tente novamente.")}},ve=()=>{if(!A){m.error("Preencha o valor do depósito");return}if(console.log("Attempting deposit with platform:",T),!T){console.log("No platform selected, proceeding without platform"),k("deposit",A,"");return}k("deposit",A,T)},Ne=()=>{if(!E){m.error("Preencha o valor do saque");return}if(console.log("Attempting withdraw with platform:",S),!S){console.log("No platform selected, proceeding without platform"),k("withdraw",E,"");return}k("withdraw",E,S)},H=(a,s)=>{navigator.clipboard.writeText(a),m.success(`${s} copiado!`)};return t?e.jsx(Y,{children:e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>n("/gestao-funcionarios"),children:e.jsx(De,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:t.name}),e.jsx("p",{className:"text-muted-foreground",children:"Perfil do Funcionário"})]}),e.jsxs(c,{variant:"outline",className:"gap-2",onClick:xe,children:[e.jsx(K,{className:"h-4 w-4"}),"Editar"]}),e.jsxs(Ae,{children:[e.jsx(Ee,{asChild:!0,children:e.jsxs(c,{variant:"destructive",className:"gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Excluir"]})}),e.jsxs(Pe,{children:[e.jsxs(Fe,{children:[e.jsx(Re,{children:"Confirmar Exclusão"}),e.jsxs(ke,{children:["Tem certeza que deseja excluir o funcionário ",t.name,"? Esta ação não pode ser desfeita e todas as transações relacionadas serão perdidas."]})]}),e.jsxs(Ie,{children:[e.jsx(Be,{children:"Cancelar"}),e.jsx(ze,{onClick:je,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:G.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Excluindo..."]}):"Excluir"})]})]})]})]}),e.jsx(I,{className:"p-6 shadow-card",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{className:"text-sm text-muted-foreground",children:"CPF"}),e.jsx("p",{className:"text-lg font-semibold",children:t.cpf})]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>H(t.cpf,"CPF"),children:e.jsx(O,{className:"h-4 w-4"})})]}),t.email&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{className:"text-sm text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-lg font-semibold",children:t.email})]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>H(t.email,"Email"),children:e.jsx(O,{className:"h-4 w-4"})})]}),t.phone&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{className:"text-sm text-muted-foreground",children:"Telefone"}),e.jsx("p",{className:"text-lg font-semibold",children:t.phone})]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>H(t.phone,"Telefone"),children:e.jsx(O,{className:"h-4 w-4"})})]}),t.birthDate&&e.jsxs("div",{children:[e.jsx(l,{className:"text-sm text-muted-foreground",children:"Data de Nascimento"}),e.jsx("p",{className:"text-lg font-semibold",children:new Date(t.birthDate).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx("div",{className:"mt-2",children:e.jsx(ee,{variant:t.status==="active"?"default":"secondary",className:t.status==="active"?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${t.status==="active","bg-white"}`}),t.status==="active"?"Ativo":"Inativo"]})})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{className:"p-6 shadow-card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Registrar Depósito"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Valor (BRL)"}),e.jsx(x,{type:"number",placeholder:"0,00",value:A,onChange:a=>_(a.target.value)})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Plataforma"}),e.jsxs(y,{value:T,onValueChange:$,children:[e.jsx(b,{children:e.jsx(D,{placeholder:"Selecione a plataforma"})}),e.jsx(w,{children:N.map(a=>e.jsx(j,{value:a.id,children:a.name},a.id))})]})]}),e.jsx(c,{onClick:ve,disabled:L.isPending,className:"w-full bg-destructive hover:bg-destructive/90",children:"Registrar Depósito"})]})]}),e.jsxs(I,{className:"p-6 shadow-card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Registrar Saque"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Valor (BRL)"}),e.jsx(x,{type:"number",placeholder:"0,00",value:E,onChange:a=>M(a.target.value)})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Plataforma"}),e.jsxs(y,{value:S,onValueChange:W,children:[e.jsx(b,{children:e.jsx(D,{placeholder:"Selecione a plataforma"})}),e.jsx(w,{children:N.map(a=>e.jsx(j,{value:a.id,children:a.name},a.id))})]})]}),e.jsx(c,{onClick:Ne,disabled:L.isPending,className:"w-full",style:{backgroundColor:"#9333EA"},children:"Registrar Saque"})]})]})]}),e.jsxs(I,{className:"shadow-card",children:[e.jsx("div",{className:"p-6 border-b border-border/50",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Histórico de Movimentações (Hoje)"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ie,{children:[e.jsx(le,{children:e.jsxs(B,{children:[e.jsx(C,{children:"Tipo"}),e.jsx(C,{children:"Plataforma"}),e.jsx(C,{children:"Data/Hora"}),e.jsx(C,{children:"Valor"}),e.jsx(C,{className:"text-right",children:"Ações"})]})}),e.jsx(oe,{children:J.length===0?e.jsx(B,{children:e.jsx(f,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"Nenhuma movimentação hoje"})}):J.map(a=>e.jsxs(B,{children:[e.jsx(f,{children:e.jsx(ee,{className:a.type==="deposit"?"bg-destructive text-destructive-foreground hover:bg-destructive/80":"bg-success text-success-foreground hover:bg-success/80",children:a.type==="deposit"?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3"}),"Depósito"]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ce,{className:"h-3 w-3"}),"Saque"]})})}),e.jsx(f,{children:e.jsx("span",{className:"font-semibold",style:{color:N.find(u=>u.id===a.platformId)?.color||"#FF5C00"},children:N.find(u=>u.id===a.platformId)?.name||"N/A"})}),e.jsx(f,{children:(()=>{const s=a.createdAt?.toDate?.()||new Date(a.createdAt||a.date),u=s.toLocaleDateString("pt-BR",{timeZone:"America/Sao_Paulo",day:"2-digit",month:"2-digit",year:"numeric"}),p=s.toLocaleTimeString("pt-BR",{timeZone:"America/Sao_Paulo",hour:"2-digit",minute:"2-digit"});return`${u} ${p}`})()}),e.jsx(f,{children:e.jsxs("span",{className:a.type==="deposit"?"text-destructive":"text-success",children:[a.type==="deposit"?"-":"+","R$"," ",Number(a.amount).toLocaleString("pt-BR")]})}),e.jsx(f,{className:"text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>ge(a),children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>ue.mutate(a.id),children:e.jsx(X,{className:"h-4 w-4"})})]})})]},a.id))})]})})]}),e.jsx(ae,{open:ne,onOpenChange:P,children:e.jsxs(se,{className:"sm:max-w-[500px]",children:[e.jsxs(te,{children:[e.jsx(re,{children:"Editar Funcionário"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Preencha as informações do funcionário. Apenas o nome é obrigatório."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-name",children:"Nome Completo"}),e.jsx(x,{id:"edit-name",value:i.name,onChange:a=>h(s=>({...s,name:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-cpf",children:"CPF"}),e.jsx(x,{id:"edit-cpf",value:i.cpf,onChange:a=>h(s=>({...s,cpf:a.target.value})),placeholder:"000.000.000-00 (opcional)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-email",children:"E-mail"}),e.jsx(x,{id:"edit-email",type:"email",value:i.email,onChange:a=>h(s=>({...s,email:a.target.value})),placeholder:"email@exemplo.com (opcional)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-phone",children:"Telefone"}),e.jsx(x,{id:"edit-phone",value:i.phone,onChange:a=>h(s=>({...s,phone:a.target.value})),placeholder:"(00) 00000-0000 (opcional)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-birthDate",children:"Data de Nascimento"}),e.jsx(x,{id:"edit-birthDate",type:"date",value:i.birthDate,onChange:a=>h(s=>({...s,birthDate:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-salary",children:"Salário (R$)"}),e.jsx(x,{id:"edit-salary",type:"number",placeholder:"0,00",value:i.salary,onChange:a=>h(s=>({...s,salary:Number(a.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-payDay",children:"Dia do Pagamento"}),e.jsxs(y,{value:i.payDay.toString(),onValueChange:a=>h(s=>({...s,payDay:Number(a)})),children:[e.jsx(b,{children:e.jsx(D,{placeholder:"Selecione o dia"})}),e.jsx(w,{children:Array.from({length:31},(a,s)=>s+1).map(a=>e.jsxs(j,{value:a.toString(),children:[a,"º dia do mês"]},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-status",children:"Status do Funcionário"}),e.jsxs(y,{value:i.status,onValueChange:a=>h(s=>({...s,status:a})),children:[e.jsx(b,{children:e.jsx(D,{placeholder:"Selecione o status"})}),e.jsxs(w,{children:[e.jsx(j,{value:"active",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Ativo"]})}),e.jsx(j,{value:"inactive",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),"Inativo"]})})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>P(!1),children:"Cancelar"}),e.jsx(c,{onClick:pe,disabled:z.isPending,children:z.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Salvando..."]}):"Salvar"})]})]})]})}),e.jsx(ae,{open:de,onOpenChange:F,children:e.jsxs(se,{className:"sm:max-w-[500px]",children:[e.jsx(te,{children:e.jsx(re,{children:"Editar Transação"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit-amount",children:"Valor"}),e.jsx(x,{id:"edit-amount",type:"number",value:v.amount,onChange:a=>R(s=>({...s,amount:a.target.value})),placeholder:"Digite o valor"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit-type",children:"Tipo"}),e.jsxs(y,{value:v.type,onValueChange:a=>R(s=>({...s,type:a})),children:[e.jsx(b,{children:e.jsx(D,{})}),e.jsxs(w,{children:[e.jsx(j,{value:"deposit",children:"Depósito"}),e.jsx(j,{value:"withdraw",children:"Saque"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit-platform",children:"Plataforma"}),e.jsxs(y,{value:v.platformId,onValueChange:a=>R(s=>({...s,platformId:a})),children:[e.jsx(b,{children:e.jsx(D,{placeholder:"Selecione uma plataforma"})}),e.jsx(w,{children:N.map(a=>e.jsx(j,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(c,{variant:"outline",onClick:()=>F(!1),children:"Cancelar"}),e.jsxs(c,{onClick:fe,disabled:V.isPending,children:[V.isPending&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Salvar"]})]})]})]})})]})}):e.jsx(Y,{children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Carregando..."})})})};export{da as default};
