import{j as e,a6 as k,a7 as L,p as b,i as t}from"./ui-vendor-COgSaoh6.js";import{u as U,r as u}from"./react-vendor-a_rYd-gI.js";import{D as E,A as I,i as T,a as z,b as F,c as R,d as V,e as O,f as $,g as B}from"./DashboardLayout-gNRGy55i.js";import{i as G,C as i,k as p,B as r,H}from"./index-CpWZ38xQ.js";import{L as o}from"./label-D3vsPjsu.js";import{I as n}from"./input-QpeNTTno.js";import{G as q}from"./firebase-vendor-BE8L9dHK.js";import{d as J}from"./user-subcollections.service-Be66DGXL.js";import"./index-Ba2OgRVY.js";import"./chart-vendor-2xH8hKrZ.js";const re=()=>{const{user:a,logout:M}=G(),d=U(),[c,m]=u.useState(""),[v,x]=u.useState(!1),[f,j]=u.useState(!1),C=()=>{t.success("Perfil atualizado com sucesso!")},y=async()=>{if(c.toLowerCase()!=="sim"){t.error('Digite "sim" para confirmar a exclusão');return}try{const s=H.currentUser,l=s?.uid;if(!s||!l){t.error("Usuário não autenticado");return}await J(l),await q(s),t.success("Conta excluída com sucesso"),x(!1),m(""),d("/")}catch(s){s?.code==="auth/requires-recent-login"?t.error("Por segurança, faça login novamente e tente excluir a conta."):t.error("Não foi possível excluir a conta. Tente novamente.")}},P=()=>{x(!0),m("")},w=async()=>{if(!a?.email){t.error("Não foi possível identificar seu e-mail. Faça login novamente.");return}try{j(!0);const s="optify-definitivo",A=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?`http://localhost:5001/${s}/southamerica-east1/mpCreatePreference`:`https://southamerica-east1-${s}.cloudfunctions.net/mpCreatePreference`,S={plano:(a?.planId||a?.plan||"standard").toString().toLowerCase(),periodo:"mensal",email:a.email},g=await fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)}),h=await g.json();if(!g.ok){t.error("Falha ao criar preferência de pagamento.");return}const N=h.initPoint||h.init_point||h.sandboxInitPoint;N?window.location.href=N:t.error("Link de pagamento não retornado.")}catch{t.error("Erro ao iniciar assinatura.")}finally{j(!1)}},D=[{date:"2024-10-01",plan:"Ultimate",amount:199,status:"paid"},{date:"2024-09-01",plan:"Ultimate",amount:199,status:"paid"},{date:"2024-08-01",plan:"Standard",amount:49,status:"paid"}];return e.jsx(E,{children:e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Meu Perfil"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie suas informações pessoais"})]}),e.jsx(i,{className:"p-6 shadow-card",children:e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsx("div",{className:"p-4 bg-primary/10 rounded-full",children:e.jsx(k,{className:"h-16 w-16 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h2",{className:"text-2xl font-bold",children:a?.name}),e.jsx(p,{variant:"default",className:"capitalize",children:a?.plan}),a?.isAdmin&&e.jsx(p,{variant:"secondary",children:"Admin"})]}),e.jsx("p",{className:"text-muted-foreground mb-4",children:a?.email}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>d("/planos"),children:"Gerenciar Plano"})]})]})}),e.jsxs(i,{className:"p-6 shadow-card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-6",children:"Informações Pessoais"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Nome Completo"}),e.jsx(n,{defaultValue:a?.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Email"}),e.jsx(n,{type:"email",defaultValue:a?.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Telefone"}),e.jsx(n,{type:"tel",placeholder:"(11) 99999-9999"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"CPF/CNPJ"}),e.jsx(n,{placeholder:"000.000.000-00"})]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(r,{onClick:C,children:"Salvar Alterações"})})]}),e.jsxs(i,{className:"p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(L,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Plano Atual"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Plano"}),e.jsx("p",{className:"text-xl font-bold capitalize",children:a?.plan})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Próximo Pagamento"}),e.jsx("p",{className:"text-xl font-bold",children:"01/11/2024"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Valor Mensal"}),e.jsx("p",{className:"text-xl font-bold",children:a?.plan==="free"?"Grátis":a?.plan==="standard"?"R$ 49":a?.plan==="medium"?"R$ 99":"R$ 199"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{variant:"outline",onClick:()=>d("/planos"),children:"Alterar Plano"}),e.jsx(r,{onClick:w,disabled:f,children:f?"Redirecionando...":"Assinar Plano"})]})]}),e.jsxs(i,{className:"shadow-card",children:[e.jsx("div",{className:"p-6 border-b border-border",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Histórico de Pagamentos"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 font-semibold",children:"Data"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Plano"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Valor"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Status"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Nota Fiscal"})]})}),e.jsx("tbody",{children:D.map((s,l)=>e.jsxs("tr",{className:"border-t border-border hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"p-4 text-sm text-muted-foreground",children:new Date(s.date).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"p-4",children:s.plan}),e.jsxs("td",{className:"p-4 font-semibold",children:["R$ ",s.amount]}),e.jsx("td",{className:"p-4",children:e.jsx(p,{variant:"default",children:"Pago"})}),e.jsx("td",{className:"p-4",children:e.jsx(r,{variant:"ghost",size:"sm",children:"Download"})})]},l))})]})})]}),e.jsxs(i,{className:"p-6 shadow-card border-destructive/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(b,{className:"h-5 w-5 text-destructive"}),e.jsx("h3",{className:"text-lg font-semibold text-destructive",children:"Zona de Perigo"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Uma vez que você exclua sua conta, não há como voltar atrás. Por favor, tenha certeza."}),e.jsxs(I,{open:v,onOpenChange:x,children:[e.jsx(T,{asChild:!0,children:e.jsx(r,{variant:"destructive",onClick:P,children:"Excluir Conta"})}),e.jsxs(z,{className:"bg-card border-border",children:[e.jsxs(F,{children:[e.jsxs(R,{className:"text-foreground flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-destructive"}),"Confirmar Exclusão de Conta"]}),e.jsxs(V,{className:"text-muted-foreground",children:["Esta ação é ",e.jsx("strong",{children:"irreversível"}),". Todos os seus dados serão permanentemente excluídos."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg",children:[e.jsx("p",{className:"text-sm text-destructive font-medium mb-2",children:"⚠️ Atenção: Esta ação não pode ser desfeita"}),e.jsxs("ul",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Todos os seus dados serão excluídos permanentemente"}),e.jsx("li",{children:"• Seu histórico de transações será perdido"}),e.jsx("li",{children:"• Suas configurações serão removidas"}),e.jsx("li",{children:"• Você precisará criar uma nova conta para usar o sistema"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{htmlFor:"deleteConfirmation",className:"text-sm font-medium text-foreground",children:["Para confirmar, digite ",e.jsx("strong",{children:'"sim"'})," abaixo:"]}),e.jsx(n,{id:"deleteConfirmation",type:"text",placeholder:"Digite 'sim' para confirmar",value:c,onChange:s=>m(s.target.value),className:"border-destructive/50 focus:border-destructive"})]})]}),e.jsxs(O,{children:[e.jsx($,{className:"bg-muted hover:bg-muted/80 text-foreground border-border",children:"Cancelar"}),e.jsx(B,{onClick:y,disabled:c.toLowerCase()!=="sim",className:"bg-destructive hover:bg-destructive/90 text-destructive-foreground disabled:opacity-50 disabled:cursor-not-allowed",children:"Excluir Conta Permanentemente"})]})]})]})]})]})})};export{re as default};
