import{j as e,i as g}from"./ui-vendor-BKTCjC1N.js";import{r}from"./react-vendor-a_rYd-gI.js";import{D as $}from"./DashboardLayout-q6rxeK_Q.js";import{P as q}from"./ProtectedPageContent-BO_3Rl5U.js";import{i as G,C as d,k as H,B as N}from"./index-SqI1anxU.js";import{I as U}from"./input-D95wG3bR.js";import{S as D,a as E,b as C,c as B,d as m}from"./select-B0D5tgNH.js";import{c as J,g as K}from"./useFirestore-CWK9mQXj.js";import"./firebase-vendor-DKIO36wX.js";import"./index-DIdW4MCp.js";import"./chart-vendor-2xH8hKrZ.js";import"./index-CdAzXW5_.js";import"./user-specific.service-C9pIzcyq.js";import"./user-subcollections.service-CeICSZJy.js";const de=()=>{const{user:p}=G(),{data:h=[]}=J(p?.uid||""),I=K(),[i,y]=r.useState({}),[R,V]=r.useState({}),[k,S]=r.useState({}),[F,v]=r.useState({}),u=r.useRef({}),[n,b]=r.useState("name"),[o,f]=r.useState("asc");r.useEffect(()=>{const s={};h.forEach(a=>{s[a.id]=Number(a.salary||0)}),y(s)},[h]),r.useEffect(()=>()=>{Object.values(u.current).forEach(s=>{s&&clearTimeout(s)})},[]);const x=[...h].sort((s,a)=>{let t,l;switch(n){case"name":t=s.name.toLowerCase(),l=a.name.toLowerCase();break;case"salary":t=i[s.id]||s.salary||0,l=i[a.id]||a.salary||0;break;case"payDay":t=s.payDay||1,l=a.payDay||1;break;default:return 0}return t<l?o==="asc"?-1:1:t>l?o==="asc"?1:-1:0}).map(s=>({id:s.id,employeeId:s.id,employeeName:s.name,amount:Number(i[s.id]||s.salary||0),status:Math.random()>.5?"paid":"pending",dueDate:new Date().toISOString(),paidDate:Math.random()>.5?new Date().toISOString():void 0})),T=async(s,a)=>{if(p?.uid){S(t=>({...t,[s]:!0}));try{await I.mutateAsync({userId:p.uid,id:s,data:{salary:a,updatedAt:new Date}}),g.success("Salário atualizado com sucesso!")}catch(t){console.error("Erro ao atualizar salário:",t),g.error("Erro ao atualizar salário. Tente novamente.")}finally{S(t=>({...t,[s]:!1}))}}},L=(s,a)=>{const t=a.replace(/[^0-9,.-]/g,"").replace(",","."),l=parseFloat(t)||0;y(A=>({...A,[s]:l})),u.current[s]&&clearTimeout(u.current[s]),u.current[s]=setTimeout(()=>{T(s,l)},2e3)},O=s=>{v(a=>({...a,[s]:!0}))},M=s=>{v(a=>({...a,[s]:!1}))},j=s=>{n===s?f(o==="asc"?"desc":"asc"):(b(s),f("asc"))},z=s=>{V(a=>({...a,[s]:a[s]==="paid"?"pending":"paid"})),g.success("Status atualizado!")},c=s=>R[s.id]||s.status,w=x.filter(s=>c(s)==="pending").reduce((s,a)=>s+a.amount,0),P=x.filter(s=>c(s)==="paid").reduce((s,a)=>s+a.amount,0);return e.jsx($,{children:e.jsx(q,{requiredFeature:"payments",featureName:"Pagamentos",requiredPlan:"Medium",children:e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Pagamentos"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie os pagamentos dos funcionários"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(d,{className:"p-6 shadow-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Total a Pagar"}),e.jsxs("p",{className:"text-3xl font-bold text-warning",children:["R$ ",w.toLocaleString("pt-BR")]})]}),e.jsxs(d,{className:"p-6 shadow-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Total Pago"}),e.jsxs("p",{className:"text-3xl font-bold text-success",children:["R$ ",P.toLocaleString("pt-BR")]})]}),e.jsxs(d,{className:"p-6 shadow-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Total Geral"}),e.jsxs("p",{className:"text-3xl font-bold",children:["R$ ",(w+P).toLocaleString("pt-BR")]})]})]}),e.jsx(d,{className:"p-4 shadow-card",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Ordenar por:"}),e.jsxs(D,{value:n,onValueChange:s=>b(s),children:[e.jsx(E,{className:"w-40",children:e.jsx(C,{})}),e.jsxs(B,{children:[e.jsx(m,{value:"name",children:"Nome"}),e.jsx(m,{value:"salary",children:"Salário"}),e.jsx(m,{value:"payDay",children:"Dia do Pagamento"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Ordem:"}),e.jsxs(D,{value:o,onValueChange:s=>f(s),children:[e.jsx(E,{className:"w-32",children:e.jsx(C,{})}),e.jsxs(B,{children:[e.jsx(m,{value:"asc",children:"Crescente"}),e.jsx(m,{value:"desc",children:"Decrescente"})]})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[x.length," funcionário(s) encontrado(s)"]})]})}),e.jsx(d,{className:"shadow-card overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 font-semibold",children:e.jsxs("button",{onClick:()=>j("name"),className:"flex items-center gap-2 hover:text-primary transition-colors cursor-pointer",children:["Funcionário",n==="name"&&e.jsx("span",{className:"text-primary text-xs",children:o==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"text-left p-4 font-semibold",children:e.jsxs("button",{onClick:()=>j("salary"),className:"flex items-center gap-2 hover:text-primary transition-colors cursor-pointer",children:["Valor",n==="salary"&&e.jsx("span",{className:"text-primary text-xs",children:o==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"text-left p-4 font-semibold",children:e.jsxs("button",{onClick:()=>j("payDay"),className:"flex items-center gap-2 hover:text-primary transition-colors cursor-pointer",children:["Vencimento",n==="payDay"&&e.jsx("span",{className:"text-primary text-xs",children:o==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Status"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Ações"})]})}),e.jsx("tbody",{children:x.map(s=>e.jsxs("tr",{className:"border-t border-border hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"p-4 font-medium",children:s.employeeName}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(U,{type:"text",inputMode:"decimal",value:(i[s.employeeId]||0)===0&&!F[s.employeeId]?"":Number(i[s.employeeId]||0).toFixed(2).replace(".",","),className:"w-32 pr-8",placeholder:"0,00",onChange:a=>L(s.employeeId,a.target.value),onFocus:()=>O(s.employeeId),onBlur:()=>M(s.employeeId)}),k[s.employeeId]&&e.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"})})]})}),e.jsx("td",{className:"p-4 text-sm text-muted-foreground",children:new Date(s.dueDate).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"p-4",children:e.jsx(H,{variant:c(s)==="paid"?"default":"secondary",children:c(s)==="paid"?"Pago":"Pendente"})}),e.jsx("td",{className:"p-4",children:e.jsx(N,{size:"sm",variant:c(s)==="paid"?"outline":"default",onClick:()=>z(s.id),children:c(s)==="paid"?"Marcar como Pendente":"Marcar como Pago"})})]},s.id))})]})})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(N,{variant:"outline",children:"Exportar"}),e.jsx(N,{variant:"success",children:"Processar Pagamentos"})]})]})})})};export{de as default};
