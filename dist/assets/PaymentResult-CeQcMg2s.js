import{j as e,ab as m,ac as V,a8 as D,s as E,y as I,d as A}from"./ui-vendor-BKTCjC1N.js";import{i as R,r as t,L as N}from"./react-vendor-a_rYd-gI.js";import{D as v}from"./DashboardLayout-DWwLFzCc.js";import{i as M,C as F,B as f,U as L}from"./index-CGNlKej4.js";import"./firebase-vendor-Dsl9zeYT.js";import"./input-ChKtT3xH.js";import"./index-DSDJpQMQ.js";import"./chart-vendor-CfBne3GF.js";function J({mode:l}){const[C]=R(),o=C.get("payment_id"),[y,w]=t.useState(null),[S,p]=t.useState(!0),[s,x]=t.useState(l),[d,h]=t.useState(!1),[n,$]=t.useState(null),[P,k]=t.useState(!1),[g,j]=t.useState(!1),{user:i}=M(),b=async()=>{if(i?.uid)try{const r=await L.getUserProfile(i.uid);$(r)}catch(r){console.error("Erro ao buscar perfil:",r)}},u=async()=>{if(o){h(!0);try{const c=await(await fetch(`undefined/checkPaymentStatus?paymentId=${o}`)).json();w(c),c?.status==="approved"&&x("success")}catch(r){console.error("Erro ao verificar status:",r)}finally{h(!1)}}};t.useEffect(()=>{i?.uid&&b()},[i?.uid]),t.useEffect(()=>{n?.plano&&n.plano!=="free"&&s==="pending"&&x("success")},[n?.plano,s]),t.useEffect(()=>{s==="success"&&l!=="success"?(k(!0),setTimeout(()=>{j(!0)},1500)):s==="success"&&j(!0)},[s,l]),t.useEffect(()=>{if(!o){p(!1);return}if(u(),p(!1),s==="pending"){const r=setInterval(()=>{u(),b()},5e3);return()=>clearInterval(r)}},[o,s]);const a=(()=>{switch(s){case"success":return{icon:A,title:"Pagamento Aprovado!",description:"Seu plano foi ativado com sucesso. Aproveite todos os recursos!",iconBg:"bg-emerald-500/10",iconColor:"text-emerald-500",titleColor:"text-foreground",descriptionColor:"text-muted-foreground",cardBg:"bg-background border-border",buttonVariant:"default",showRefresh:!1};case"failure":return{icon:I,title:"Pagamento Falhou",description:"N√£o foi poss√≠vel processar seu pagamento. Tente novamente.",iconBg:"bg-red-500/10",iconColor:"text-red-500",titleColor:"text-foreground",descriptionColor:"text-muted-foreground",cardBg:"bg-background border-border",buttonVariant:"default",showRefresh:!0};case"pending":return{icon:E,title:"Pagamento Pendente",description:"Seu pagamento est√° sendo processado. Verificando status automaticamente...",iconBg:"bg-amber-500/10",iconColor:"text-amber-500",titleColor:"text-foreground",descriptionColor:"text-muted-foreground",cardBg:"bg-background border-border",buttonVariant:"outline",showRefresh:!0}}})(),B=a.icon;return S?e.jsx(v,{children:e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{className:"h-6 w-6 animate-spin text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Carregando..."})]})})}):e.jsx(v,{children:e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative",children:[P&&s==="success"&&e.jsx("div",{className:"fixed inset-0 pointer-events-none z-50",children:[...Array(50)].map((r,c)=>e.jsx("div",{className:"absolute animate-bounce",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animationDelay:`${Math.random()*2}s`,animationDuration:`${2+Math.random()*2}s`},children:e.jsx(V,{className:"h-4 w-4 text-emerald-500"})},c))}),e.jsx(F,{className:`w-full max-w-2xl p-8 ${a.cardBg} border shadow-lg transition-all duration-1000 ${g?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:`p-4 rounded-full ${a.iconBg} transition-all duration-1000 ${g?"scale-100":"scale-0"}`,children:e.jsx(B,{className:`h-12 w-12 ${a.iconColor} ${s==="success"?"animate-pulse":""}`})})}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("h1",{className:`text-4xl font-bold ${a.titleColor}`,children:a.title}),e.jsx("p",{className:`text-lg ${a.descriptionColor} max-w-md mx-auto`,children:a.description})]}),o&&e.jsx("div",{className:"bg-muted/50 rounded-xl p-6 border",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Detalhes do Pagamento"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["ID: ",e.jsx("span",{className:"font-mono bg-muted px-2 py-1 rounded",children:o})]}),n?.plano&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Plano Atual: ",e.jsx("span",{className:"font-semibold text-foreground capitalize",children:n.plano})]})]})}),d&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(m,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Verificando status..."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(f,{asChild:!0,className:"flex items-center gap-2",children:e.jsxs(N,{to:"/planos",children:[e.jsx(D,{className:"h-4 w-4"}),"Voltar aos Planos"]})}),e.jsx(f,{asChild:!0,variant:a.buttonVariant,children:e.jsx(N,{to:"/dashboard",children:"Ir para Dashboard"})}),a.showRefresh&&e.jsxs(f,{variant:"outline",onClick:u,disabled:d,className:"flex items-center gap-2",children:[e.jsx(m,{className:`h-4 w-4 ${d?"animate-spin":""}`}),"Verificar Status"]})]}),e.jsxs("div",{className:"text-center space-y-2 text-sm text-muted-foreground",children:[s==="success"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"‚úÖ Seu plano foi ativado automaticamente"}),e.jsx("p",{children:"üéâ Voc√™ pode gerenciar sua assinatura no seu perfil"})]}),s==="failure"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"‚ùå Se o problema persistir, entre em contato conosco"}),e.jsx("p",{children:"üí≥ Verifique se seus dados de pagamento est√£o corretos"})]}),s==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"‚è≥ O processamento pode levar alguns minutos"}),e.jsx("p",{children:"üìß Voc√™ receber√° um email quando o pagamento for confirmado"}),e.jsx("p",{children:"üîÑ Esta p√°gina atualiza automaticamente"})]})]}),y&&!1]})})]})})}export{J as default};
