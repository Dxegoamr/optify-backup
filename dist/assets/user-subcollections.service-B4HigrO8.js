var f=Object.defineProperty;var y=(c,t,a)=>t in c?f(c,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[t]=a;var w=(c,t,a)=>y(c,typeof t!="symbol"?t+"":t,a);import{e as u,s as n,h as A,f as h,u as D,w as E,y as F,x as R,v as U,K as O}from"./firebase-vendor-BUxvNq0f.js";import{n as i}from"./index-LiAbW-2G.js";class S{static async saveToUserSubcollection(t,a,r,e){try{const o=u(i,this.usersCollection,t,a,r),s={...e,createdAt:n(),updatedAt:n()};await A(o,s)}catch(o){throw console.error(`Erro ao salvar em ${a}:`,o),new Error(`Falha ao salvar dados em ${a}`)}}static async getFromUserSubcollection(t,a,r){try{const e=u(i,this.usersCollection,t,a,r),o=await h(e);if(o.exists()){const s=o.data();return{...s,createdAt:s.createdAt?.toDate()||new Date,updatedAt:s.updatedAt?.toDate()||new Date}}return null}catch(e){throw console.error(`Erro ao buscar de ${a}:`,e),new Error(`Falha ao buscar dados de ${a}`)}}static async updateUserSubcollection(t,a,r,e){try{const o=u(i,this.usersCollection,t,a,r),s=Object.fromEntries(Object.entries(e).filter(([m,l])=>l!==void 0));if(a==="dailySummaries"&&"transactionsSnapshot"in s){const m=await h(o);if(m.exists()){const l=m.data();l?.transactionsSnapshot&&Array.isArray(l.transactionsSnapshot)&&l.transactionsSnapshot.length>0&&delete s.transactionsSnapshot}}(await h(o)).exists()?await D(o,{...s,updatedAt:n()}):await A(o,{...s,createdAt:n(),updatedAt:n()})}catch(o){throw console.error(`Erro ao atualizar ${a}:`,o),new Error(`Falha ao atualizar dados de ${a}`)}}static async getAllFromUserSubcollection(t,a,r=[]){try{const e=E(i,this.usersCollection,t,a),o=F(e,...r);return(await R(o)).docs.map(d=>({id:d.id,...d.data(),createdAt:d.data().createdAt?.toDate()||new Date,updatedAt:d.data().updatedAt?.toDate()||new Date}))}catch(e){throw console.error(`Erro ao buscar todos de ${a}:`,e),new Error(`Falha ao buscar dados de ${a}`)}}static async addToUserSubcollection(t,a,r){try{console.log(`UserSubcollectionsService.addToUserSubcollection - salvando em ${a}:`,{userId:t,data:r});const e=E(i,this.usersCollection,t,a),o={...r,createdAt:n(),updatedAt:n()};console.log("Dados com timestamps:",o);const s=await U(e,o);return console.log(`Documento criado com ID: ${s.id}`),s.id}catch(e){throw console.error(`Erro ao adicionar em ${a}:`,e),new Error(`Falha ao adicionar dados em ${a}`)}}static async deleteFromUserSubcollection(t,a,r){try{const e=u(i,this.usersCollection,t,a,r);await O(e)}catch(e){throw console.error(`Erro ao deletar de ${a}:`,e),new Error(`Falha ao deletar dados de ${a}`)}}}w(S,"usersCollection","users");const p={PROFILE:"profile",CONFIG:"config",EMPLOYEES:"employees",PLATFORMS:"platforms",TRANSACTIONS:"transactions",DAILY_SUMMARIES:"dailySummaries",ACCOUNTS:"accounts",PAYMENTS:"payments",GOALS:"goals",REPORTS:"reports",SUREBET_RECORDS:"surebetRecords"};async function b(c){const t=Object.values(p);for(const a of t)try{a===p.PROFILE?await S.deleteFromUserSubcollection(c,a,"basic"):a===p.CONFIG&&await S.deleteFromUserSubcollection(c,a,"initial");const r=await S.getAllFromUserSubcollection(c,a);await Promise.all(r.map(e=>e?.id?S.deleteFromUserSubcollection(c,a,e.id):Promise.resolve()))}catch(r){console.warn(`Falha parcial ao deletar subcoleção ${a} do usuário ${c}:`,r)}}export{S as U,p as a,b as d};
