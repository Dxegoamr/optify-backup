import{j as e,i as g}from"./ui-vendor-BTHa3W3g.js";import{r}from"./react-vendor-a_rYd-gI.js";import{D as M}from"./DashboardLayout-CBEB3xAj.js";import{i as $,C as d,j as G,B as N}from"./index-tUWBtyMw.js";import{I as H}from"./input-DW9y-Xvy.js";import{S as E,a as P,b as C,c as B,d as m}from"./select-plxRJV4o.js";import{e as U,g as q}from"./useFirestore-CXqcU13q.js";import"./firebase-vendor-D8A9P6qX.js";import"./index-DFZ8kcLn.js";import"./chart-vendor-CfBne3GF.js";import"./index-CdAzXW5_.js";import"./user-specific.service-aZ13ZUNq.js";import"./user-subcollections.service-BuAugs-p.js";const ne=()=>{const{user:h}=$(),{data:p=[]}=U(h?.uid||""),I=q(),[i,y]=r.useState({}),[R,V]=r.useState({}),[T,S]=r.useState({}),[k,v]=r.useState({}),u=r.useRef({}),[n,b]=r.useState("name"),[l,f]=r.useState("asc");r.useEffect(()=>{const s={};p.forEach(a=>{s[a.id]=a.salary||0}),y(s)},[p]),r.useEffect(()=>()=>{Object.values(u.current).forEach(s=>{s&&clearTimeout(s)})},[]);const x=[...p].sort((s,a)=>{let t,o;switch(n){case"name":t=s.name.toLowerCase(),o=a.name.toLowerCase();break;case"salary":t=i[s.id]||s.salary||0,o=i[a.id]||a.salary||0;break;case"payDay":t=s.payDay||1,o=a.payDay||1;break;default:return 0}return t<o?l==="asc"?-1:1:t>o?l==="asc"?1:-1:0}).map(s=>({id:s.id,employeeId:s.id,employeeName:s.name,amount:i[s.id]||s.salary||0,status:Math.random()>.5?"paid":"pending",dueDate:new Date().toISOString(),paidDate:Math.random()>.5?new Date().toISOString():void 0})),L=async(s,a)=>{if(h?.uid){S(t=>({...t,[s]:!0}));try{await I.mutateAsync({userId:h.uid,id:s,data:{salary:a,updatedAt:new Date}}),g.success("Salário atualizado com sucesso!")}catch(t){console.error("Erro ao atualizar salário:",t),g.error("Erro ao atualizar salário. Tente novamente.")}finally{S(t=>({...t,[s]:!1}))}}},O=(s,a)=>{const t=parseFloat(a)||0;y(o=>({...o,[s]:t})),u.current[s]&&clearTimeout(u.current[s]),u.current[s]=setTimeout(()=>{L(s,t)},2e3)},F=s=>{v(a=>({...a,[s]:!0}))},z=s=>{v(a=>({...a,[s]:!1}))},j=s=>{n===s?f(l==="asc"?"desc":"asc"):(b(s),f("asc"))},A=s=>{V(a=>({...a,[s]:a[s]==="paid"?"pending":"paid"})),g.success("Status atualizado!")},c=s=>R[s.id]||s.status,w=x.filter(s=>c(s)==="pending").reduce((s,a)=>s+a.amount,0),D=x.filter(s=>c(s)==="paid").reduce((s,a)=>s+a.amount,0);return e.jsx(M,{children:e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Pagamentos"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie os pagamentos dos funcionários"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(d,{className:"p-6 shadow-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Total a Pagar"}),e.jsxs("p",{className:"text-3xl font-bold text-warning",children:["R$ ",w.toLocaleString("pt-BR")]})]}),e.jsxs(d,{className:"p-6 shadow-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Total Pago"}),e.jsxs("p",{className:"text-3xl font-bold text-success",children:["R$ ",D.toLocaleString("pt-BR")]})]}),e.jsxs(d,{className:"p-6 shadow-card",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Total Geral"}),e.jsxs("p",{className:"text-3xl font-bold",children:["R$ ",(w+D).toLocaleString("pt-BR")]})]})]}),e.jsx(d,{className:"p-4 shadow-card",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Ordenar por:"}),e.jsxs(E,{value:n,onValueChange:s=>b(s),children:[e.jsx(P,{className:"w-40",children:e.jsx(C,{})}),e.jsxs(B,{children:[e.jsx(m,{value:"name",children:"Nome"}),e.jsx(m,{value:"salary",children:"Salário"}),e.jsx(m,{value:"payDay",children:"Dia do Pagamento"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Ordem:"}),e.jsxs(E,{value:l,onValueChange:s=>f(s),children:[e.jsx(P,{className:"w-32",children:e.jsx(C,{})}),e.jsxs(B,{children:[e.jsx(m,{value:"asc",children:"Crescente"}),e.jsx(m,{value:"desc",children:"Decrescente"})]})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[x.length," funcionário(s) encontrado(s)"]})]})}),e.jsx(d,{className:"shadow-card overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 font-semibold",children:e.jsxs("button",{onClick:()=>j("name"),className:"flex items-center gap-2 hover:text-primary transition-colors cursor-pointer",children:["Funcionário",n==="name"&&e.jsx("span",{className:"text-primary text-xs",children:l==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"text-left p-4 font-semibold",children:e.jsxs("button",{onClick:()=>j("salary"),className:"flex items-center gap-2 hover:text-primary transition-colors cursor-pointer",children:["Valor",n==="salary"&&e.jsx("span",{className:"text-primary text-xs",children:l==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"text-left p-4 font-semibold",children:e.jsxs("button",{onClick:()=>j("payDay"),className:"flex items-center gap-2 hover:text-primary transition-colors cursor-pointer",children:["Vencimento",n==="payDay"&&e.jsx("span",{className:"text-primary text-xs",children:l==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Status"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Ações"})]})}),e.jsx("tbody",{children:x.map(s=>e.jsxs("tr",{className:"border-t border-border hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"p-4 font-medium",children:s.employeeName}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(H,{type:"number",value:k[s.employeeId]&&(i[s.employeeId]||0)===0?"":i[s.employeeId]||0,className:"w-32 pr-8",placeholder:"0,00",onChange:a=>O(s.employeeId,a.target.value),onFocus:()=>F(s.employeeId),onBlur:()=>z(s.employeeId)}),T[s.employeeId]&&e.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"})})]})}),e.jsx("td",{className:"p-4 text-sm text-muted-foreground",children:new Date(s.dueDate).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"p-4",children:e.jsx(G,{variant:c(s)==="paid"?"default":"secondary",children:c(s)==="paid"?"Pago":"Pendente"})}),e.jsx("td",{className:"p-4",children:e.jsx(N,{size:"sm",variant:c(s)==="paid"?"outline":"default",onClick:()=>A(s.id),children:c(s)==="paid"?"Marcar como Pendente":"Marcar como Pago"})})]},s.id))})]})})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(N,{variant:"outline",children:"Exportar"}),e.jsx(N,{variant:"success",children:"Processar Pagamentos"})]})]})})};export{ne as default};
