import{n as ve,j as e,a8 as Ne,N as J,p as K,a as z,a3 as L,e as ye,o as De,i as n}from"./ui-vendor-CYAqJ0RG.js";import{k as be,u as we,r as m}from"./react-vendor-a_rYd-gI.js";import{c as Ce,u as Te,g as Se,w as Ae,d as Ee,e as Pe,x as Fe,b as Ie,D as X,A as ke,o as Re,h as Be,i as ze,j as Le,k as Ve,l as qe,m as He,n as Oe}from"./DashboardLayout-B3XyjcMy.js";import{h as $e,B as l,C as F,j as Y}from"./index-LiAbW-2G.js";import{I as h}from"./input-J7GhaNSr.js";import{L as r}from"./label-DLesFRW0.js";import{S as g,a as f,b as v,c as N,d as x}from"./select-Bd9uzrFY.js";import{T as Me,a as _e,b as V,c as w,d as We,e as y}from"./table-DkP3UmhY.js";import{D as ee,b as ae,c as se,d as te}from"./dialog-DkFBrAVQ.js";import{shouldDisplayAsPositive as ie}from"./financial-calculations-dg7KAW8P.js";import"./user-specific.service-C1DLMu9g.js";import"./user-subcollections.service-B4HigrO8.js";import"./firebase-vendor-BUxvNq0f.js";import"./user-notifications.service-CAzP-qxP.js";import"./index-DMSHDzho.js";import"./chart-vendor-ctXMAO2v.js";import"./index-CdAzXW5_.js";const ca=()=>{const{id:q}=be(),H=we();ve();const{user:o}=$e(),[C,O]=m.useState(""),[D,$]=m.useState(""),[T,M]=m.useState(""),[b,_]=m.useState(""),[re,S]=m.useState(!1),[le,A]=m.useState(!1),[W,Z]=m.useState(null),[p,E]=m.useState({amount:"",platformId:"",type:"deposit"}),[i,c]=m.useState({name:"",cpf:"",email:"",phone:"",birthDate:"",salary:0,payDay:1,status:"active"}),{data:ne=[]}=Ce(o?.uid||""),t=ne.find(a=>a.id===q),U=new Date().toLocaleDateString("pt-BR",{timeZone:"America/Sao_Paulo"}).split("/").reverse().join("-"),{data:oe=[]}=Te(o?.uid||"",U,U),ce=oe.filter(a=>a.employeeId===q&&(!a.description||!a.description.includes("Ajuste manual de saldo"))).sort((a,s)=>{const d=a.createdAt?.toDate?.()||new Date(a.createdAt||a.date);return(s.createdAt?.toDate?.()||new Date(s.createdAt||s.date)).getTime()-d.getTime()}),I=Se(),Q=Ae(),k=Ee(),de=Pe(),R=Fe(),me=()=>{t&&(c({name:t.name,cpf:t.cpf||"",email:t.email||"",phone:t.phone||"",birthDate:t.birthDate||"",salary:t.salary||0,payDay:t.payDay||1,status:t.status||"active"}),S(!0))},he=async()=>{if(!(!t||!o?.uid)){if(!i.name.trim()){n.error("O nome é obrigatório");return}try{const a={name:i.name.trim(),updatedAt:new Date};i.cpf.trim()&&(a.cpf=i.cpf.trim()),i.email.trim()&&(a.email=i.email.trim()),i.phone.trim()&&(a.phone=i.phone.trim()),i.birthDate&&(a.birthDate=i.birthDate),i.salary>0&&(a.salary=i.salary),i.payDay>0&&(a.payDay=i.payDay),a.status=i.status,await I.mutateAsync({userId:o.uid,id:t.id,data:a}),n.success("Funcionário atualizado com sucesso!"),S(!1)}catch(a){console.error("Erro ao atualizar funcionário:",a),n.error("Erro ao atualizar funcionário. Tente novamente.")}}},ue=async()=>{if(!(!t||!o?.uid))try{await Q.mutateAsync({userId:o.uid,id:t.id}),n.success("Funcionário excluído com sucesso!"),H("/gestao-funcionarios")}catch(a){console.error("Erro ao excluir funcionário:",a),n.error("Erro ao excluir funcionário. Tente novamente.")}},xe=a=>{Z(a),E({amount:a.amount.toString(),platformId:a.platformId||"",type:a.type}),A(!0)},pe=async()=>{if(!(!W||!o?.uid))try{await R.mutateAsync({userId:o.uid,id:W.id,data:{amount:Number(p.amount),platformId:p.platformId,type:p.type}}),n.success("Transação atualizada com sucesso!"),A(!1),Z(null)}catch(a){console.error("Erro ao atualizar transação:",a),n.error("Erro ao atualizar transação. Tente novamente.")}},{data:j=[]}=Ie(o?.uid||"");console.log("Platforms loaded:",j),console.log("Deposit platform:",D),console.log("Withdraw platform:",b);const G=ce,P=async(a,s,d)=>{if(!(!t||!o?.uid))try{const u={userId:o.uid,employeeId:t.id,platformId:d,type:a,amount:Number(s),date:new Date().toLocaleDateString("pt-BR",{timeZone:"America/Sao_Paulo"}).split("/").reverse().join("-")};console.log("Creating transaction:",u),console.log("Transaction date being saved:",u.date);const fe=await k.mutateAsync(u);console.log("Transaction created with ID:",fe),n.success(`${a==="deposit"?"Depósito":"Saque"} registrado com sucesso!`),a==="deposit"?(O(""),$("")):(M(""),_(""))}catch(u){console.error("Erro ao registrar transação:",u),n.error("Erro ao registrar transação. Tente novamente.")}},je=()=>{if(!C){n.error("Preencha o valor do depósito");return}if(console.log("Attempting deposit with platform:",D),!D){console.log("No platform selected, proceeding without platform"),P("deposit",C,"");return}P("deposit",C,D)},ge=()=>{if(!T){n.error("Preencha o valor do saque");return}if(console.log("Attempting withdraw with platform:",b),!b){console.log("No platform selected, proceeding without platform"),P("withdraw",T,"");return}P("withdraw",T,b)},B=(a,s)=>{navigator.clipboard.writeText(a),n.success(`${s} copiado!`)};return t?e.jsx(X,{children:e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>H("/gestao-funcionarios"),children:e.jsx(Ne,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:t.name}),e.jsx("p",{className:"text-muted-foreground",children:"Perfil do Funcionário"})]}),e.jsxs(l,{variant:"outline",className:"gap-2",onClick:me,children:[e.jsx(J,{className:"h-4 w-4"}),"Editar"]}),e.jsxs(ke,{children:[e.jsx(Re,{asChild:!0,children:e.jsxs(l,{variant:"destructive",className:"gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Excluir"]})}),e.jsxs(Be,{children:[e.jsxs(ze,{children:[e.jsx(Le,{children:"Confirmar Exclusão"}),e.jsxs(Ve,{children:["Tem certeza que deseja excluir o funcionário ",t.name,"? Esta ação não pode ser desfeita e todas as transações relacionadas serão perdidas."]})]}),e.jsxs(qe,{children:[e.jsx(He,{children:"Cancelar"}),e.jsx(Oe,{onClick:ue,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:Q.isPending?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),"Excluindo..."]}):"Excluir"})]})]})]})]}),e.jsx(F,{className:"p-6 shadow-card",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(r,{className:"text-sm text-muted-foreground",children:"CPF"}),e.jsx("p",{className:"text-lg font-semibold",children:t.cpf})]}),e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>B(t.cpf,"CPF"),children:e.jsx(L,{className:"h-4 w-4"})})]}),t.email&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(r,{className:"text-sm text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-lg font-semibold",children:t.email})]}),e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>B(t.email,"Email"),children:e.jsx(L,{className:"h-4 w-4"})})]}),t.phone&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(r,{className:"text-sm text-muted-foreground",children:"Telefone"}),e.jsx("p",{className:"text-lg font-semibold",children:t.phone})]}),e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>B(t.phone,"Telefone"),children:e.jsx(L,{className:"h-4 w-4"})})]}),t.birthDate&&e.jsxs("div",{children:[e.jsx(r,{className:"text-sm text-muted-foreground",children:"Data de Nascimento"}),e.jsx("p",{className:"text-lg font-semibold",children:new Date(t.birthDate).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx("div",{className:"mt-2",children:e.jsx(Y,{variant:t.status==="active"?"default":"secondary",className:t.status==="active"?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${t.status==="active","bg-white"}`}),t.status==="active"?"Ativo":"Inativo"]})})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"p-6 shadow-card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Registrar Depósito"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Valor (BRL)"}),e.jsx(h,{type:"number",placeholder:"0,00",value:C,onChange:a=>O(a.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Plataforma"}),e.jsxs(g,{value:D,onValueChange:$,children:[e.jsx(f,{children:e.jsx(v,{placeholder:"Selecione a plataforma"})}),e.jsx(N,{children:j.map(a=>e.jsx(x,{value:a.id,children:a.name},a.id))})]})]}),e.jsx(l,{onClick:je,disabled:k.isPending,className:"w-full bg-destructive hover:bg-destructive/90",children:"Registrar Depósito"})]})]}),e.jsxs(F,{className:"p-6 shadow-card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Registrar Saque"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Valor (BRL)"}),e.jsx(h,{type:"number",placeholder:"0,00",value:T,onChange:a=>M(a.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Plataforma"}),e.jsxs(g,{value:b,onValueChange:_,children:[e.jsx(f,{children:e.jsx(v,{placeholder:"Selecione a plataforma"})}),e.jsx(N,{children:j.map(a=>e.jsx(x,{value:a.id,children:a.name},a.id))})]})]}),e.jsx(l,{onClick:ge,disabled:k.isPending,className:"w-full",style:{backgroundColor:"#9333EA"},children:"Registrar Saque"})]})]})]}),e.jsxs(F,{className:"shadow-card",children:[e.jsx("div",{className:"p-6 border-b border-border/50",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Histórico de Movimentações (Hoje)"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Me,{children:[e.jsx(_e,{children:e.jsxs(V,{children:[e.jsx(w,{children:"Tipo"}),e.jsx(w,{children:"Plataforma"}),e.jsx(w,{children:"Data/Hora"}),e.jsx(w,{children:"Valor"}),e.jsx(w,{className:"text-right",children:"Ações"})]})}),e.jsx(We,{children:G.length===0?e.jsx(V,{children:e.jsx(y,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"Nenhuma movimentação hoje"})}):G.map(a=>e.jsxs(V,{children:[e.jsx(y,{children:e.jsx(Y,{className:a.type==="deposit"?"bg-destructive text-destructive-foreground hover:bg-destructive/80":"bg-success text-success-foreground hover:bg-success/80",children:a.type==="deposit"?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"h-3 w-3"}),"Depósito"]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"h-3 w-3"}),"Saque"]})})}),e.jsx(y,{children:e.jsx("span",{className:"font-semibold",style:{color:j.find(d=>d.id===a.platformId)?.color||"#FF5C00"},children:j.find(d=>d.id===a.platformId)?.name||"N/A"})}),e.jsx(y,{children:(()=>{const s=a.createdAt?.toDate?.()||new Date(a.createdAt||a.date),d=s.toLocaleDateString("pt-BR",{timeZone:"America/Sao_Paulo",day:"2-digit",month:"2-digit",year:"numeric"}),u=s.toLocaleTimeString("pt-BR",{timeZone:"America/Sao_Paulo",hour:"2-digit",minute:"2-digit"});return`${d} ${u}`})()}),e.jsx(y,{children:e.jsxs("span",{className:ie(a)?"text-success":"text-destructive",children:[ie(a)?"+":"-","R$"," ",Number(a.amount).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})]})}),e.jsx(y,{className:"text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>xe(a),children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>de.mutate(a.id),children:e.jsx(K,{className:"h-4 w-4"})})]})})]},a.id))})]})})]}),e.jsx(ee,{open:re,onOpenChange:S,children:e.jsxs(ae,{className:"sm:max-w-[500px]",children:[e.jsxs(se,{children:[e.jsx(te,{children:"Editar Funcionário"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Preencha as informações do funcionário. Apenas o nome é obrigatório."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit-name",children:"Nome Completo"}),e.jsx(h,{id:"edit-name",value:i.name,onChange:a=>c(s=>({...s,name:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit-cpf",children:"CPF"}),e.jsx(h,{id:"edit-cpf",value:i.cpf,onChange:a=>c(s=>({...s,cpf:a.target.value})),placeholder:"000.000.000-00 (opcional)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit-email",children:"E-mail"}),e.jsx(h,{id:"edit-email",type:"email",value:i.email,onChange:a=>c(s=>({...s,email:a.target.value})),placeholder:"email@exemplo.com (opcional)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit-phone",children:"Telefone"}),e.jsx(h,{id:"edit-phone",value:i.phone,onChange:a=>c(s=>({...s,phone:a.target.value})),placeholder:"(00) 00000-0000 (opcional)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit-birthDate",children:"Data de Nascimento"}),e.jsx(h,{id:"edit-birthDate",type:"date",value:i.birthDate,onChange:a=>c(s=>({...s,birthDate:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit-salary",children:"Salário (R$)"}),e.jsx(h,{id:"edit-salary",type:"number",placeholder:"0,00",value:i.salary,onChange:a=>c(s=>({...s,salary:Number(a.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit-payDay",children:"Dia do Pagamento"}),e.jsxs(g,{value:i.payDay.toString(),onValueChange:a=>c(s=>({...s,payDay:Number(a)})),children:[e.jsx(f,{children:e.jsx(v,{placeholder:"Selecione o dia"})}),e.jsx(N,{children:Array.from({length:31},(a,s)=>s+1).map(a=>e.jsxs(x,{value:a.toString(),children:[a,"º dia do mês"]},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit-status",children:"Status do Funcionário"}),e.jsxs(g,{value:i.status,onValueChange:a=>c(s=>({...s,status:a})),children:[e.jsx(f,{children:e.jsx(v,{placeholder:"Selecione o status"})}),e.jsxs(N,{children:[e.jsx(x,{value:"active",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Ativo"]})}),e.jsx(x,{value:"inactive",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),"Inativo"]})})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>S(!1),children:"Cancelar"}),e.jsx(l,{onClick:he,disabled:I.isPending,children:I.isPending?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),"Salvando..."]}):"Salvar"})]})]})]})}),e.jsx(ee,{open:le,onOpenChange:A,children:e.jsxs(ae,{className:"sm:max-w-[500px]",children:[e.jsx(se,{children:e.jsx(te,{children:"Editar Transação"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit-amount",children:"Valor"}),e.jsx(h,{id:"edit-amount",type:"number",value:p.amount,onChange:a=>E(s=>({...s,amount:a.target.value})),placeholder:"Digite o valor"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit-type",children:"Tipo"}),e.jsxs(g,{value:p.type,onValueChange:a=>E(s=>({...s,type:a})),children:[e.jsx(f,{children:e.jsx(v,{})}),e.jsxs(N,{children:[e.jsx(x,{value:"deposit",children:"Depósito"}),e.jsx(x,{value:"withdraw",children:"Saque"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit-platform",children:"Plataforma"}),e.jsxs(g,{value:p.platformId,onValueChange:a=>E(s=>({...s,platformId:a})),children:[e.jsx(f,{children:e.jsx(v,{placeholder:"Selecione uma plataforma"})}),e.jsx(N,{children:j.map(a=>e.jsx(x,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(l,{variant:"outline",onClick:()=>A(!1),children:"Cancelar"}),e.jsxs(l,{onClick:pe,disabled:R.isPending,children:[R.isPending&&e.jsx(z,{className:"mr-2 h-4 w-4 animate-spin"}),"Salvar"]})]})]})]})})]})}):e.jsx(X,{children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Carregando..."})})})};export{ca as default};
