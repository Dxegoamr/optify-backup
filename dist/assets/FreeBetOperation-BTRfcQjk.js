import{j as e,m as le,n as ce,u as ue,a8 as me,P as xe,d as pe,ae as he,af as fe,D as be,e as ve,i as I}from"./ui-vendor-CYAqJ0RG.js";import{r as c,k as je,u as ge}from"./react-vendor-a_rYd-gI.js";import{c as ye,D as Q}from"./DashboardLayout-B3XyjcMy.js";import{c as Ne,d as ee,P as W,a as Y,b as Ce,v as ke,u as Fe,g as Z,h as we,B as A,C as G,q as L,r as V,t as z,l as Se}from"./index-LiAbW-2G.js";import{I as O}from"./input-J7GhaNSr.js";import{L as S}from"./label-DLesFRW0.js";import{u as Re}from"./index-CdAzXW5_.js";import{D as Ee,b as $e,c as Be,d as Ae,e as De}from"./dialog-DkFBrAVQ.js";import{F as P}from"./freebet.service-9e18y7QZ.js";import{b as Ie,c as H}from"./user-specific.service-C1DLMu9g.js";import"./user-notifications.service-CAzP-qxP.js";import"./firebase-vendor-BUxvNq0f.js";import"./index-DMSHDzho.js";import"./chart-vendor-ctXMAO2v.js";import"./user-subcollections.service-B4HigrO8.js";var _="Checkbox",[Pe,er]=Ne(_),[qe,X]=Pe(_);function Te(s){const{__scopeCheckbox:f,checked:t,children:x,defaultChecked:n,disabled:m,form:v,name:d,onCheckedChange:h,required:p,value:g="on",internal_do_not_use_render:j}=s,[b,y]=Fe({prop:t,defaultProp:n??!1,onChange:h,caller:_}),[N,C]=c.useState(null),[k,u]=c.useState(null),o=c.useRef(!1),B=N?!!v||!!N.closest("form"):!0,F={checked:b,disabled:m,setChecked:y,control:N,setControl:C,name:d,form:v,value:g,hasConsumerStoppedPropagationRef:o,required:p,defaultChecked:E(n)?!1:n,isFormControl:B,bubbleInput:k,setBubbleInput:u};return e.jsx(qe,{scope:f,...F,children:Oe(j)?j(F):x})}var re="CheckboxTrigger",te=c.forwardRef(({__scopeCheckbox:s,onKeyDown:f,onClick:t,...x},n)=>{const{control:m,value:v,disabled:d,checked:h,required:p,setControl:g,setChecked:j,hasConsumerStoppedPropagationRef:b,isFormControl:y,bubbleInput:N}=X(re,s),C=ee(n,g),k=c.useRef(h);return c.useEffect(()=>{const u=m?.form;if(u){const o=()=>j(k.current);return u.addEventListener("reset",o),()=>u.removeEventListener("reset",o)}},[m,j]),e.jsx(W.button,{type:"button",role:"checkbox","aria-checked":E(h)?"mixed":h,"aria-required":p,"data-state":ie(h),"data-disabled":d?"":void 0,disabled:d,value:v,...x,ref:C,onKeyDown:Y(f,u=>{u.key==="Enter"&&u.preventDefault()}),onClick:Y(t,u=>{j(o=>E(o)?!0:!o),N&&y&&(b.current=u.isPropagationStopped(),b.current||u.stopPropagation())})})});te.displayName=re;var J=c.forwardRef((s,f)=>{const{__scopeCheckbox:t,name:x,checked:n,defaultChecked:m,required:v,disabled:d,value:h,onCheckedChange:p,form:g,...j}=s;return e.jsx(Te,{__scopeCheckbox:t,checked:n,defaultChecked:m,disabled:d,required:v,onCheckedChange:p,name:x,form:g,value:h,internal_do_not_use_render:({isFormControl:b})=>e.jsxs(e.Fragment,{children:[e.jsx(te,{...j,ref:f,__scopeCheckbox:t}),b&&e.jsx(ne,{__scopeCheckbox:t})]})})});J.displayName=_;var se="CheckboxIndicator",ae=c.forwardRef((s,f)=>{const{__scopeCheckbox:t,forceMount:x,...n}=s,m=X(se,t);return e.jsx(Ce,{present:x||E(m.checked)||m.checked===!0,children:e.jsx(W.span,{"data-state":ie(m.checked),"data-disabled":m.disabled?"":void 0,...n,ref:f,style:{pointerEvents:"none",...s.style}})})});ae.displayName=se;var oe="CheckboxBubbleInput",ne=c.forwardRef(({__scopeCheckbox:s,...f},t)=>{const{control:x,hasConsumerStoppedPropagationRef:n,checked:m,defaultChecked:v,required:d,disabled:h,name:p,value:g,form:j,bubbleInput:b,setBubbleInput:y}=X(oe,s),N=ee(t,y),C=Re(m),k=ke(x);c.useEffect(()=>{const o=b;if(!o)return;const B=window.HTMLInputElement.prototype,T=Object.getOwnPropertyDescriptor(B,"checked").set,R=!n.current;if(C!==m&&T){const U=new Event("click",{bubbles:R});o.indeterminate=E(m),T.call(o,E(m)?!1:m),o.dispatchEvent(U)}},[b,C,m,n]);const u=c.useRef(E(m)?!1:m);return e.jsx(W.input,{type:"checkbox","aria-hidden":!0,defaultChecked:v??u.current,required:d,disabled:h,name:p,value:g,form:j,...f,tabIndex:-1,ref:N,style:{...f.style,...k,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});ne.displayName=oe;function Oe(s){return typeof s=="function"}function E(s){return s==="indeterminate"}function ie(s){return E(s)?"indeterminate":s?"checked":"unchecked"}const q=c.forwardRef(({className:s,...f},t)=>e.jsx(J,{ref:t,className:Z("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...f,children:e.jsx(ae,{className:Z("flex items-center justify-center text-current"),children:e.jsx(le,{className:"h-4 w-4"})})}));q.displayName=J.displayName;const rr=()=>{const{operationId:s}=je(),f=ge(),{user:t}=we(),x=ce(),{data:n,isLoading:m}=ue({queryKey:["freebet-operation",t?.uid,s],queryFn:()=>P.getOperation(t?.uid||"",s||""),enabled:!!t?.uid&&!!s}),{data:v=[]}=ye(t?.uid||""),[d,h]=c.useState([]),[p,g]=c.useState(0),[j,b]=c.useState(!1),[y,N]=c.useState([]),C=c.useRef(!1),k=c.useRef(null);c.useEffect(()=>{C.current=!1,k.current=null},[s]),c.useEffect(()=>{!n||!(!C.current||k.current!==n.id)||(C.current=!0,k.current=n.id,h(n.funcionarios||[]),g(n.valorFreeBet||0))},[n,s]);const u=c.useMemo(()=>d.filter(r=>!r.vencedor||r.vencedor&&r.vencedorRecebeFreebet===!0),[d]),o=c.useMemo(()=>{const r=d.reduce(($,K)=>$+(K.valorApostado||0),0),i=d.find($=>$.vencedor)?.retorno||0,l=r-i,w=u.length*p,D=u.reduce(($,K)=>$+(K.conversaoSaldo||0),0),M=i+D-r;return{totalApostado:r,retorno:i,perdaFreeBet:l,totalFreeBets:w,totalConversaoSaldo:D,lucroGeral:M}},[d,p,u]),B=c.useCallback(async()=>{if(!(!t?.uid||!s))try{await P.updateOperation(t.uid,s,{funcionarios:d,valorFreeBet:p}),x.invalidateQueries({queryKey:["freebet-operation",t.uid,s]}),x.invalidateQueries({queryKey:["freebet-operations",t.uid]})}catch(r){console.error("Erro ao salvar operação:",r)}},[t?.uid,s,d,p,x]),F=c.useRef(),T=async()=>{const r=y.filter(i=>!d.find(l=>l.id===i)).map(i=>{const l=v.find(w=>w.id===i);return{id:l?.id||i,nome:l?.name||l?.nome||"Funcionário",valorApostado:0,vencedor:!1}}),a=[...d,...r];if(h(a),N([]),b(!1),!(!t?.uid||!s))try{await P.updateOperation(t.uid,s,{funcionarios:a,valorFreeBet:p}),x.invalidateQueries({queryKey:["freebet-operation",t.uid,s]}),x.invalidateQueries({queryKey:["freebet-operations",t.uid]}),I.success("Funcionários adicionados!")}catch(i){I.error("Erro ao adicionar funcionários"),console.error(i)}},R=(r,a)=>{const i=d.map(l=>l.id===r?{...l,...a}:a.vencedor&&a.vencedor===!0?{...l,vencedor:!1}:l);h(i)},U=r=>{h(d.filter(a=>a.id!==r))},de=async()=>{if(!t?.uid){I.error("Usuário não autenticado");return}try{const r=Se(),a=o.lucroGeral;let i;if(a!==0){const M=a>0?"deposit":"withdraw",$=Math.abs(a);i=await Ie.createTransaction(t.uid,{employeeId:"",platformId:"",type:M,amount:$,description:`FreeBet ${n?.platformName||"Operação"}`,date:r})}const l=await H.getDailySummaryByDate(t.uid,r),w=a>0?a:0,D=a<0?Math.abs(a):0;l?await H.updateDailySummary(t.uid,l.id,{totalDeposits:(l.totalDeposits||0)+w,totalWithdraws:(l.totalWithdraws||0)+D,profit:(l.profit||l.margin||0)+a,margin:(l.margin||l.profit||0)+a,transactionCount:(l.transactionCount||0)+1,updatedAt:new Date}):await H.createDailySummary(t.uid,{date:r,totalDeposits:w,totalWithdraws:D,profit:a,margin:a,transactionCount:1,transactionsSnapshot:[],byEmployee:[],createdAt:new Date,updatedAt:new Date}),x.invalidateQueries({queryKey:["firebase-all-daily-summaries",t.uid]}),x.invalidateQueries({queryKey:["firebase-daily-summaries",t.uid]}),x.invalidateQueries({queryKey:["firebase-transactions",t.uid]}),s&&n&&await P.addHistoryEntry(t.uid,{operationId:s,platformName:n.platformName,platformColor:n.platformColor,funcionarios:d,valorFreeBet:p,totalApostado:o.totalApostado,retorno:o.retorno,totalConversaoSaldo:o.totalConversaoSaldo,lucro:a,transactionId:i,closedAt:new Date}),s&&(await P.updateOperation(t.uid,s,{funcionarios:[],valorFreeBet:0}),x.invalidateQueries({queryKey:["freebet-operations",t.uid]}),x.invalidateQueries({queryKey:["freebet-operation",t.uid,s]}),x.invalidateQueries({queryKey:["freebet-history",t.uid]})),h([]),g(0),I.success(a>0?`Depósito de R$ ${a.toFixed(2)} registrado com sucesso!`:`Saque de R$ ${Math.abs(a).toFixed(2)} registrado com sucesso!`),f("/freebet")}catch(r){console.error("Erro ao fechar operação:",r),I.error("Erro ao fechar operação. Tente novamente.")}};return c.useEffect(()=>{if(n&&d.length>0)return F.current&&clearTimeout(F.current),F.current=setTimeout(()=>{B()},1500),()=>{F.current&&clearTimeout(F.current)}},[d,p,n,B]),m?e.jsx(Q,{children:e.jsx("div",{className:"flex h-96 items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Carregando..."})})}):n?e.jsxs(Q,{children:[e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>f("/freebet"),children:e.jsx(me,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Operação ",n.platformName]}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie sua operação FreeBet"})]})]}),e.jsxs(A,{onClick:()=>b(!0),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Adicionar Funcionários"]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(G,{children:[e.jsx(L,{children:e.jsx(V,{children:"Funcionários e Valores"})}),e.jsx(z,{className:"space-y-4",children:d.length===0?e.jsx("p",{className:"text-center text-muted-foreground",children:"Nenhum funcionário adicionado ainda"}):d.map((r,a)=>e.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border p-4 sm:flex-row sm:items-center sm:gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(S,{className:"text-sm font-medium",children:r.nome})}),e.jsxs("div",{className:"flex flex-1 flex-col gap-2 sm:flex-row",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(S,{htmlFor:`valor-${r.id}`,className:"text-xs",children:"Valor Apostado"}),e.jsx(O,{id:`valor-${r.id}`,type:"number",step:"0.01",value:r.valorApostado||"",onChange:i=>R(r.id,{valorApostado:parseFloat(i.target.value)||0}),placeholder:"0.00"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{id:`vencedor-${r.id}`,checked:r.vencedor||!1,onCheckedChange:i=>R(r.id,{vencedor:i===!0})}),e.jsx(S,{htmlFor:`vencedor-${r.id}`,className:"text-xs",children:"Vencedora"})]}),r.vencedor&&e.jsxs("div",{className:"flex flex-1 flex-col gap-2",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:`retorno-${r.id}`,className:"text-xs",children:"Valor Retorno"}),e.jsx(O,{id:`retorno-${r.id}`,type:"number",step:"0.01",value:r.retorno||"",onChange:i=>R(r.id,{retorno:parseFloat(i.target.value)||0}),placeholder:"0.00"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{id:`vencedor-freebet-${r.id}`,checked:r.vencedorRecebeFreebet||!1,onCheckedChange:i=>R(r.id,{vencedorRecebeFreebet:i===!0})}),e.jsx(S,{htmlFor:`vencedor-freebet-${r.id}`,className:"text-xs cursor-pointer",children:"Também recebe FreeBet"})]})]}),e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>U(r.id),children:e.jsx("span",{className:"text-red-500",children:"×"})})]})]},r.id))})]}),e.jsxs(G,{children:[e.jsx(L,{children:e.jsx(V,{children:"Resumo dos Cálculos"})}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"valor-freebet",children:"Valor da FreeBet"}),e.jsx(O,{id:"valor-freebet",type:"number",step:"0.01",value:p||"",onChange:r=>{g(parseFloat(r.target.value)||0)},placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Apostado:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",o.totalApostado.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Conta Vencedora (retorno):"}),e.jsx("span",{className:"font-semibold",children:o.retorno>0?`R$ ${o.retorno.toFixed(2)}`:"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Perda p/ FreeBet:"}),e.jsxs("span",{className:`font-semibold ${o.perdaFreeBet>=0?"text-red-600":"text-green-600"}`,children:["R$ ",o.perdaFreeBet.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total em FreeBets:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",o.totalFreeBets.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Conversão Saldo:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",o.totalConversaoSaldo.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Lucro Geral:"}),e.jsxs("span",{className:`font-bold text-lg ${o.lucroGeral>=0?"text-green-600":"text-red-600"}`,children:[o.lucroGeral>=0?"+":"","R$ ",o.lucroGeral.toFixed(2)]})]})]}),e.jsxs(A,{onClick:de,className:"w-full mt-4",variant:"default",size:"lg",children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Fechar Operação"]})]})]})]}),e.jsxs(G,{className:"mt-6",children:[e.jsxs(L,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-primary"}),e.jsx(V,{children:"Conversão das FreeBets"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Gerencie as freebets e registre as conversões em saldo. A conta vencedora também pode receber freebet se marcada."})]}),e.jsx(z,{children:u.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Nenhuma conta com freebet. Marque uma conta como vencedora para que as outras recebam freebet, ou marque a vencedora para também receber freebet."}):e.jsxs("div",{className:"space-y-4",children:[u.map(r=>e.jsxs("div",{className:`flex flex-col gap-4 rounded-lg border p-4 transition-all sm:flex-row sm:items-center ${r.freebetUsada?"border-green-500/50 bg-green-50/50 dark:bg-green-950/20":"border-border"}`,children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex h-10 w-10 items-center justify-center rounded-full ${r.freebetUsada?"bg-green-500/20 text-green-700 dark:text-green-400":"bg-primary/10 text-primary"}`,children:e.jsx("span",{className:"font-semibold",children:r.nome.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:r.nome}),r.vencedor&&e.jsx("span",{className:"rounded bg-orange-500/20 px-2 py-0.5 text-xs font-medium text-orange-600 dark:text-orange-400",children:"Vencedora"}),r.freebetUsada&&e.jsx(fe,{className:"h-4 w-4 text-green-600"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["FreeBet: R$ ",p.toFixed(2)]})]})]})}),e.jsxs("div",{className:"flex flex-1 flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{id:`freebet-usada-${r.id}`,checked:r.freebetUsada||!1,onCheckedChange:a=>R(r.id,{freebetUsada:a===!0})}),e.jsx(S,{htmlFor:`freebet-usada-${r.id}`,className:"text-sm cursor-pointer",children:"Freebet Usada"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(S,{htmlFor:`conversao-${r.id}`,className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),"Conversão em Saldo (R$)"]}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{id:`conversao-${r.id}`,type:"number",step:"0.01",value:r.conversaoSaldo||"",onChange:a=>R(r.id,{conversaoSaldo:parseFloat(a.target.value)||0}),placeholder:"0.00",className:r.conversaoSaldo&&r.conversaoSaldo>0?"border-green-500 focus:border-green-600":""}),r.conversaoSaldo&&r.conversaoSaldo>0&&e.jsx(ve,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-green-600"})]})]})]})]},r.id)),u.length>0&&e.jsx("div",{className:"mt-6 rounded-lg border bg-muted/50 p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total FreeBets"}),e.jsx("p",{className:"text-lg font-semibold",children:u.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"FreeBets Usadas"}),e.jsx("p",{className:"text-lg font-semibold",children:u.filter(r=>r.freebetUsada).length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Convertido"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:["R$ ",o.totalConversaoSaldo.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pendente"}),e.jsx("p",{className:"text-lg font-semibold text-orange-600",children:u.filter(r=>!r.freebetUsada).length})]})]})})]})})]})]}),e.jsx(Ee,{open:j,onOpenChange:b,children:e.jsxs($e,{children:[e.jsx(Be,{children:e.jsx(Ae,{children:"Adicionar Funcionários"})}),e.jsx("div",{className:"max-h-96 space-y-2 overflow-y-auto",children:v.length===0?e.jsx("p",{className:"text-center text-muted-foreground",children:"Nenhum funcionário cadastrado"}):v.map(r=>{const a=y.includes(r.id),i=d.find(l=>l.id===r.id);return e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border p-2",children:[e.jsx(q,{id:`emp-${r.id}`,checked:a,disabled:!!i,onCheckedChange:l=>{N(l?[...y,r.id]:y.filter(w=>w!==r.id))}}),e.jsx(S,{htmlFor:`emp-${r.id}`,className:`flex-1 cursor-pointer ${i?"text-muted-foreground":""}`,children:r.name}),i&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Já adicionado"})]},r.id)})}),e.jsxs(De,{children:[e.jsx(A,{variant:"outline",onClick:()=>b(!1),children:"Cancelar"}),e.jsx(A,{onClick:T,disabled:y.length===0,children:"Adicionar"})]})]})})]}):e.jsx(Q,{children:e.jsx("div",{className:"flex h-96 items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Operação não encontrada"})})})};export{rr as default};
