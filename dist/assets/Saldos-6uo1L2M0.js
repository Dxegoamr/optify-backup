import{n as ce,j as e,P as K,N as V,w as ie,p as de,i as c}from"./ui-vendor-BTHa3W3g.js";import{r as f}from"./react-vendor-a_rYd-gI.js";import{D as me,A as ue,i as he,a as xe,b as fe,c as pe,d as ge,e as je,f as be,g as Ce}from"./DashboardLayout-CBEB3xAj.js";import{i as Ne,B as m,C as G}from"./index-tUWBtyMw.js";import{I as b}from"./input-DW9y-Xvy.js";import{L as v}from"./label-Bd_WgLui.js";import{e as ve,b as ye,u as Pe,h as we,i as De,j as Ee,k as Se,c as Ae}from"./useFirestore-CXqcU13q.js";import{D as B,a as F,b as T,c as z,d as $}from"./dialog-DeE5QvKL.js";import"./firebase-vendor-D8A9P6qX.js";import"./index-DFZ8kcLn.js";import"./chart-vendor-CfBne3GF.js";import"./user-specific.service-aZ13ZUNq.js";import"./user-subcollections.service-BuAugs-p.js";const Ve=()=>{ce();const{user:l}=Ne(),[h,S]=f.useState({name:"",color:"#FF5C00"}),[d,C]=f.useState(null),[Q,I]=f.useState(!1),[W,L]=f.useState(!1),[M,O]=f.useState(""),[A,R]=f.useState(null),[p,y]=f.useState({}),{data:P=[]}=ve(l?.uid||""),{data:g=[]}=ye(l?.uid||""),{data:w=[]}=Pe(l?.uid||"","","");console.log("Saldos - Employees:",P.length),console.log("Saldos - Platforms:",g.length),console.log("Saldos - Transactions:",w.length),console.log("Saldos - All Transactions:",w),console.log("Saldos - Platforms IDs:",g.map(a=>({id:a.id,name:a.name}))),w.forEach((a,s)=>{console.log(`Transaction ${s}:`,{id:a.id,employeeId:a.employeeId,platformId:a.platformId,type:a.type,amount:a.amount,date:a.date})});const J=we(),D=De(),X=Ee(),k=Se(),Y=Ae(),j=(()=>{const a={};return P.forEach(s=>{a[s.id]={name:s.name,platforms:{},total:0},g.forEach(t=>{const o=w.filter(n=>n.employeeId===s.id&&n.platformId===t.id);console.log(`Debug - Employee: ${s.name}, Platform: ${t.name}, Transactions:`,o);const r=o.filter(n=>n.type==="deposit").reduce((n,x)=>n+Number(x.amount||0),0),i=o.filter(n=>n.type==="withdraw").reduce((n,x)=>n+Number(x.amount||0),0);console.log(`Debug - Deposits: ${r}, Withdraws: ${i}`);const u=r-i;a[s.id].platforms[t.id]=Math.max(0,u),a[s.id].total+=Math.max(0,u)})}),Object.values(a)})();console.log("Saldos - Platform Balances:",j);const Z=[...P].sort((a,s)=>a.name.localeCompare(s.name)),E=g.filter(a=>a.isActive!==!1),q=[...E.reduce((a,s)=>(a.find(o=>o.id===s.id||o.name===s.name)||a.push(s),a),[])].sort((a,s)=>{const t=j.reduce((r,i)=>r+(Number(i.platforms?.[a.id])||0),0),o=j.reduce((r,i)=>r+(Number(i.platforms?.[s.id])||0),0);return Number(o)-Number(t)}),_=j.reduce((a,s)=>a+(s.total||0),0),ee=g.filter(a=>a.name.toLowerCase().includes(M.toLowerCase())),ae=(a,s,t)=>{const o=`${a}-${s}`;y({...p,[o]:{employeeId:a,platformId:s,value:t.toString()}})},U=async(a,s)=>{const t=`${a}-${s}`,o=p[t];if(o)try{const r=Number(o.value),i=P.find(N=>N.id===a),n=j.find(N=>N.name===i?.name)?.platforms?.[s]||0,x=r-n;if(x!==0){const N={userId:l?.uid||"",employeeId:a,platformId:s,type:x>0?"deposit":"withdraw",amount:Math.abs(x),date:new Date().toISOString().split("T")[0],description:"Ajuste manual de saldo"};await Y.mutateAsync(N)}const H={...p};delete H[t],y(H),c.success("Saldo atualizado!")}catch(r){console.error("Erro ao atualizar saldo:",r),c.error("Erro ao atualizar saldo")}},se=(a,s)=>{const t=`${a}-${s}`,o={...p};delete o[t],y(o)},te=async()=>{if(l?.uid)try{await J.mutateAsync({userId:l.uid,name:h.name,color:h.color}),c.success("Casa de aposta criada!"),S({name:"",color:"#FF5C00"}),I(!1)}catch{c.error("Erro ao criar casa de aposta")}},oe=async()=>{if(d)try{await D.mutateAsync({userId:l?.uid||"",id:d.id,data:{name:d.name,color:d.color}}),c.success("Casa de aposta atualizada!"),C(null)}catch{c.error("Erro ao atualizar casa de aposta")}},re=async a=>{try{await X.mutateAsync({userId:l?.uid||"",id:a}),c.success("Casa de aposta excluída!")}catch{c.error("Erro ao excluir casa de aposta")}},le=async()=>{if(l?.uid)try{await k.mutateAsync(l.uid),c.success("Plataformas padrão criadas com sucesso!")}catch{c.error("Erro ao criar plataformas padrão")}},ne=async()=>{if(l?.uid)try{const a=[{name:"Pixbet",color:"#ADD8E6"},{name:"Betano",color:"#FF6600"},{name:"Mcgames",color:"#DC143C"},{name:"Kto",color:"#C80000"},{name:"Realsbet",color:"#00FFC8"},{name:"Vaidebet",color:"#FFD700"},{name:"Sportingbet",color:"#4682B4"},{name:"Superbet",color:"#FF3366"},{name:"Betao",color:"#FFA550"},{name:"Bet365",color:"#008040"},{name:"Esportivabet",color:"#FF8C00"},{name:"Hiperbet",color:"#DC0000"},{name:"Luvabet",color:"#ADFF2F"},{name:"Cassinopix",color:"#87CEEB"},{name:"Multibet",color:"#483D8B"}],s=g.map(t=>{const o=a.find(r=>r.name===t.name);return o&&t.color!==o.color?D.mutateAsync({userId:l.uid,id:t.id,data:{color:o.color}}):Promise.resolve()});await Promise.all(s),c.success("Cores das plataformas atualizadas!")}catch{c.error("Erro ao atualizar cores das plataformas")}};return e.jsx(me,{children:e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Saldos"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie contas e saldos por plataforma"})]}),e.jsxs("div",{className:"flex gap-2",children:[E.length===0&&e.jsxs(m,{onClick:le,disabled:k.isPending,className:"gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),k.isPending?"Criando...":"Criar Plataformas Padrão"]}),E.length>0&&e.jsxs(m,{onClick:ne,disabled:D.isPending,variant:"outline",className:"gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),D.isPending?"Atualizando...":"Atualizar Cores"]}),E.length>0&&e.jsxs(B,{open:W,onOpenChange:L,children:[e.jsx(F,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:"gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Pesquisar Plataforma"]})}),e.jsxs(T,{children:[e.jsx(z,{children:e.jsx($,{children:"Pesquisar Plataforma"})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{children:[e.jsx(v,{children:"Nome da Plataforma"}),e.jsx(b,{placeholder:"Digite o nome da plataforma...",value:M,onChange:a=>O(a.target.value)})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:ee.map(a=>e.jsxs(m,{variant:"outline",className:"w-full justify-start mb-2",onClick:()=>{R(a),L(!1),O("")},children:[e.jsx("div",{className:"w-4 h-4 rounded mr-2",style:{backgroundColor:a.color}}),a.name]},a.id))})]})]})]}),e.jsxs(B,{open:Q,onOpenChange:I,children:[e.jsx(F,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:"gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Criar Casa"]})}),e.jsxs(T,{children:[e.jsx(z,{children:e.jsx($,{children:"Criar Casa de Aposta"})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{children:[e.jsx(v,{children:"Nome"}),e.jsx(b,{value:h.name,onChange:a=>S({...h,name:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Cor"}),e.jsx(b,{type:"color",value:h.color,onChange:a=>S({...h,color:a.target.value})})]}),e.jsx(m,{className:"w-full",onClick:te,disabled:!h.name.trim(),children:"Criar"})]})]})]})]})]}),e.jsxs(G,{className:"p-6 shadow-card gradient-success",children:[e.jsx("p",{className:"text-sm text-success-foreground/80 mb-2",children:"Saldo Total"}),e.jsxs("p",{className:"text-4xl font-bold text-success-foreground",children:["R$ ",Number(_||0).toLocaleString("pt-BR")]})]}),e.jsxs(G,{className:"shadow-card overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Saldos por Plataforma"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Clique nos valores para editar. Os valores são salvos automaticamente ao sair do campo."}),A&&e.jsxs("div",{className:"mt-2 p-2 bg-muted rounded",children:[e.jsx("span",{className:"text-sm",children:"Filtrado por: "}),e.jsx("span",{className:"inline-block w-3 h-3 rounded mr-1",style:{backgroundColor:A.color}}),e.jsx("span",{className:"font-medium",children:A.name}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>R(null),className:"ml-2 h-6 px-2",children:"Limpar filtro"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50",children:[e.jsx("th",{className:"text-left p-4 font-semibold sticky left-0 bg-background z-10",children:"Funcionário"}),e.jsx("th",{className:"text-center p-4 font-semibold sticky left-20 bg-background z-10",children:"Total por Funcionário"}),q.map(a=>e.jsx("th",{className:"text-center p-4 font-semibold min-w-[120px]",style:{backgroundColor:a.color+"20"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-white font-medium",children:a.name}),e.jsxs(B,{open:d?.id===a.id,onOpenChange:s=>!s&&C(null),children:[e.jsx(F,{asChild:!0,children:e.jsx(m,{size:"icon",variant:"ghost",className:"h-6 w-6 text-white hover:bg-white/20",onClick:()=>C(a),children:e.jsx(V,{className:"h-3 w-3"})})}),e.jsxs(T,{children:[e.jsx(z,{children:e.jsx($,{children:"Editar Casa de Aposta"})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{children:[e.jsx(v,{children:"Nome"}),e.jsx(b,{value:d?.name||"",onChange:s=>C({...d,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Cor"}),e.jsx(b,{type:"color",value:d?.color||"#FF5C00",onChange:s=>C({...d,color:s.target.value})})]}),e.jsx(m,{className:"w-full",onClick:oe,disabled:!d?.name?.trim(),children:"Salvar"})]})]})]}),e.jsxs(ue,{children:[e.jsx(he,{asChild:!0,children:e.jsx(m,{size:"icon",variant:"ghost",className:"h-6 w-6 text-white hover:bg-white/20",children:e.jsx(de,{className:"h-3 w-3"})})}),e.jsxs(xe,{children:[e.jsxs(fe,{children:[e.jsx(pe,{children:"Excluir casa de aposta?"}),e.jsx(ge,{children:"Esta ação não pode ser desfeita. Todas as transações relacionadas a esta plataforma serão mantidas."})]}),e.jsxs(je,{children:[e.jsx(be,{children:"Cancelar"}),e.jsx(Ce,{onClick:()=>re(a.id),children:"Excluir"})]})]})]})]})},a.id))]})}),e.jsx("tbody",{children:Z.map(a=>{const s=j.find(t=>t.name===a.name);return e.jsxs("tr",{className:"border-t hover:bg-muted/30",children:[e.jsx("td",{className:"p-4 font-medium sticky left-0 bg-background z-10",children:a.name}),e.jsx("td",{className:"p-4 text-center font-bold sticky left-20 bg-background z-10",children:e.jsxs("span",{className:"text-success",children:["R$ ",(s?.total||0).toLocaleString("pt-BR")]})}),q.map(t=>{const o=`${a.id}-${t.id}`,r=p[o],i=s?.platforms?.[t.id]||0;return e.jsx("td",{className:"p-4 text-center",children:r?e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(b,{type:"number",value:r.value,onChange:u=>y({...p,[o]:{...r,value:u.target.value}}),className:"w-20 h-8 text-center",onKeyDown:u=>{u.key==="Enter"?U(a.id,t.id):u.key==="Escape"&&se(a.id,t.id)},onBlur:()=>U(a.id,t.id),autoFocus:!0})}):e.jsxs("span",{className:"text-success cursor-pointer hover:bg-muted/50 p-1 rounded",onClick:()=>ae(a.id,t.id,i),children:["R$ ",i.toLocaleString("pt-BR")]})},t.id)})]},a.id)})})]})})]})]})})};export{Ve as default};
