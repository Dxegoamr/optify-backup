import{j as e,O as $,V as U,N as W,p as C,P as _,i as c}from"./ui-vendor-DjlOlFa4.js";import{r as x}from"./react-vendor-a_rYd-gI.js";import{D as G,A as J,i as K,a as Q,b as X,c as Y,d as Z,e as ee,f as se,g as ae}from"./DashboardLayout-BcCfWOhy.js";import{i as te,B as l,C as u,j as re}from"./index-Bq1F_dIZ.js";import{D as T,b as A,c as E,d as F}from"./dialog-C8Tznhvv.js";import{I}from"./input-Na861OTp.js";import{L as ie}from"./label-D8vzfE-v.js";import{S as f,a as g,b as v,c as N,d as p}from"./select-Cvt1J7um.js";import{a as ne,e as le,b as oe,l as ce,m as de}from"./useFirestore-Com720Cy.js";import{f as me}from"./format-DPwKrYwk.js";import{p as he}from"./pt-BR-DnZ5gAgy.js";import"./firebase-vendor-BcqWGCj0.js";import"./index-DbOKcKFW.js";import"./chart-vendor-CfBne3GF.js";import"./index-CdAzXW5_.js";import"./user-specific.service-Cb0yNYwO.js";import"./user-subcollections.service-BB1TMMBY.js";const Fe=()=>{const{user:j}=te(),[r,z]=x.useState(null),[V,y]=x.useState(!1),[k,m]=x.useState(!1),[t,o]=x.useState(null),{data:S=[],isLoading:L}=ne(j?.uid||""),{data:D=[]}=le(j?.uid||""),{data:b=[]}=oe(j?.uid||""),O=ce(),P=de(),d=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),h=s=>me(new Date(s),"dd 'de' MMMM 'de' yyyy",{locale:he}),w=s=>s>=0?"text-success":"text-destructive",B=s=>{z(s),y(!0)},q=s=>{o(s),m(!0)},H=async s=>{try{await P.mutateAsync(s),c.success("Fechamento excluído com sucesso!")}catch(n){console.error("Erro ao excluir fechamento:",n),c.error("Erro ao excluir fechamento")}},M=async()=>{try{c.success("Histórico exportado com sucesso!")}catch{c.error("Erro ao exportar histórico")}};return e.jsx(G,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Histórico de Fechamentos"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Visualize o histórico de todos os fechamentos de dia."})]}),e.jsxs(l,{onClick:M,className:"gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Exportar PDF"]})]}),e.jsx(u,{className:"p-6",children:L?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-muted-foreground",children:"Carregando histórico..."})}):S.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-muted-foreground",children:"Nenhum fechamento encontrado"})}):e.jsx("div",{className:"space-y-4",children:S.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:h(s.date)}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.transactionCount||0," transações"]})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`font-bold ${w(s.profit||s.margin||0)}`,children:d(s.profit||s.margin||0)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lucro Total"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>B(s),children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>q(s),children:e.jsx(W,{className:"h-4 w-4"})}),e.jsxs(J,{children:[e.jsx(K,{asChild:!0,children:e.jsx(l,{variant:"ghost",size:"icon",className:"text-destructive",children:e.jsx(C,{className:"h-4 w-4"})})}),e.jsxs(Q,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Excluir Fechamento"}),e.jsxs(Z,{children:["Tem certeza que deseja excluir o fechamento do dia ",h(s.date),"? Esta ação não pode ser desfeita."]})]}),e.jsxs(ee,{children:[e.jsx(se,{children:"Cancelar"}),e.jsx(ae,{onClick:()=>H(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Excluir"})]})]})]})]})]})]},s.id))})}),e.jsx(T,{open:V,onOpenChange:y,children:e.jsxs(A,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(E,{children:e.jsxs(F,{children:["Detalhes do Fechamento - ",r&&h(r.date)]})}),r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(u,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Depósitos"}),e.jsx("div",{className:"text-2xl font-bold text-success",children:d(r.totalDeposits||0)})]}),e.jsxs(u,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Saques"}),e.jsx("div",{className:"text-2xl font-bold text-destructive",children:d(r.totalWithdraws||0)})]}),e.jsxs(u,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Lucro Total"}),e.jsx("div",{className:`text-2xl font-bold ${w(r.profit||r.margin||0)}`,children:d(r.profit||r.margin||0)})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Transações do Dia"}),r.transactionsSnapshot&&r.transactionsSnapshot.length>0?e.jsx("div",{className:"space-y-2",children:r.transactionsSnapshot.map((s,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{variant:s.type==="deposit"?"default":"destructive",children:s.type==="deposit"?"Depósito":"Saque"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:D.find(a=>a.id===s.employeeId)?.name||"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:b.find(a=>a.id===s.platformId)?.name||"N/A"})]})]}),e.jsxs("div",{className:`font-bold ${s.type==="deposit"?"text-success":"text-destructive"}`,children:[s.type==="deposit"?"+":"-",d(s.amount)]})]},n))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhuma transação registrada para este dia"})]})]})]})}),e.jsx(T,{open:k,onOpenChange:m,children:e.jsxs(A,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(E,{children:e.jsxs(F,{children:["Editar Fechamento - ",t&&h(t.date)]})}),t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"edit-date",children:"Data:"}),e.jsx(I,{id:"edit-date",type:"date",value:t.date,onChange:s=>o({...t,date:s.target.value})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Transações:"}),e.jsxs(l,{size:"sm",className:"gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Adicionar Transação"]})]}),t.transactionsSnapshot&&t.transactionsSnapshot.length>0?e.jsx("div",{className:"space-y-2",children:t.transactionsSnapshot.map((s,n)=>e.jsxs("div",{className:"grid grid-cols-5 gap-2 p-3 border rounded-lg",children:[e.jsxs(f,{value:s.employeeId,onValueChange:a=>{const i=[...t.transactionsSnapshot];i[n].employeeId=a,o({...t,transactionsSnapshot:i})},children:[e.jsx(g,{children:e.jsx(v,{placeholder:"Funcionário"})}),e.jsx(N,{children:D.map(a=>e.jsx(p,{value:a.id,children:a.name},a.id))})]}),e.jsxs(f,{value:s.type,onValueChange:a=>{const i=[...t.transactionsSnapshot];i[n].type=a,o({...t,transactionsSnapshot:i})},children:[e.jsx(g,{children:e.jsx(v,{placeholder:"Tipo"})}),e.jsxs(N,{children:[e.jsx(p,{value:"deposit",children:"Depósito"}),e.jsx(p,{value:"withdraw",children:"Saque"})]})]}),e.jsx(I,{type:"number",step:"0.01",placeholder:"Valor",value:s.amount,onChange:a=>{const i=[...t.transactionsSnapshot];i[n].amount=Number(a.target.value),o({...t,transactionsSnapshot:i})}}),e.jsxs(f,{value:s.platformId,onValueChange:a=>{const i=[...t.transactionsSnapshot];i[n].platformId=a,o({...t,transactionsSnapshot:i})},children:[e.jsx(g,{children:e.jsx(v,{placeholder:"Plataforma"})}),e.jsx(N,{children:b.map(a=>e.jsx(p,{value:a.id,children:a.name},a.id))})]}),e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>{const a=t.transactionsSnapshot.filter((i,R)=>R!==n);o({...t,transactionsSnapshot:a})},className:"text-destructive",children:e.jsx(C,{className:"h-4 w-4"})})]},n))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhuma transação registrada para este dia"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>m(!1),children:"Cancelar"}),e.jsx(l,{onClick:async()=>{try{await O.mutateAsync({summaryId:t.id,summaryData:t}),c.success("Fechamento atualizado com sucesso!"),m(!1)}catch(s){console.error("Erro ao atualizar fechamento:",s),c.error("Erro ao atualizar fechamento")}},children:"Salvar Alterações"})]})]})]})})]})})};export{Fe as default};
